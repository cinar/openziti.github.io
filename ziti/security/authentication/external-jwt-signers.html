<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>External JWT Signers | Ziti </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="External JWT Signers | Ziti ">
    <meta name="generator" content="docfx 2.x">
    
    <link rel="shortcut icon" href="../../../images/favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
    <!--span>this is text</span-->
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400&amp;display=swap" rel="stylesheet">
    <meta name="google-site-verification" content="jfzf3259Xh6i82RehhnKg4aAsHd02v1MB-jP43wEqHI">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-THVRRJ3GLE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
  
      gtag('config', 'G-THVRRJ3GLE');
    </script>
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../images/ziti-logo-40.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div style="display: flex;">
                    <div class="form-group" style="valign: center;position: relative;">
                      <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                    </div>
                    <div style="position: relative">
                        &nbsp;
                    </div>
                    <div style="position: relative">
                        <a href="https://github.com/openziti">
                            <img src="../../../images/github-white.svg" alt="Star us on GitHub" title="Star us on GitHub" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://openziti.discourse.group">
                            <img src="../../../images/discourse_icon_halo.svg" alt="Start a conversation on Discourse" title="Start a conversation on Discourse" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://twitter.com/openziti">
                            <img src="../../../images/twit.svg" alt="Follow us on Twitter" title="Follow us on Twitter" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://www.youtube.com/channel/UCAsrfQasdZmp2Gq07Ej_5cQ">
                            <img src="../../../images/yt.svg" alt="Watch videos about OpenZiti" title="Watch videos about OpenZiti" height="34px">
                        </a>
                    </div>
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default" name="new">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
          <div style="display:flex; align-items: center; justify-content: center; flex-direction:row; position: relative; width: 100%; text-align: center;     background: rgb(0,104,247);
            background: linear-gradient(90deg, rgba(0,104,247,1) 0%, rgba(222,14,91,1) 100%);">
            <span style="margin-top: 5px; color: white; margin-right: 10px; height:25px">Star us on GitHub</span>
            <span style="margin-top: 5px;"><a class="github-button" href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star openziti/ziti on GitHub">Star</a></span>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="external-jwt-signers">External JWT Signers</h1>

<p>External JWT Signers allow external identity providers to facilitate authentication with a Ziti network. External
JWT Signers can be added as a static x509 certificate or via a JWKS endpoint. Authenticating clients can provide
a JWT as a primary authentication mechanism to obtain an API Session. Additionally, the JWT can be required on
all REST API calls if desired by using an Authentication Policy that requires it as a secondary factor.</p>
<p>JWT is described in <a href="https://datatracker.ietf.org/doc/html/rfc7519">RFC 7519</a> and on <a href="https://en.wikipedia.org/wiki/JSON_Web_Token">Wikipedia</a>.
X509 PKI is described in <a href="https://datatracker.ietf.org/doc/html/rfc5280">RFC 5280</a> an on <a href="https://en.wikipedia.org/wiki/X.509">Wikipedia</a></p>
<h1 id="usage">Usage</h1>
<p>External JWT Signers are used in conjunction with Authentication Policies to allow identities to authenticate using a
JWT. External JWT Signers can be configured to match an identity through the <code>claimsProperty</code> and <code>useExternalId</code>
fields. <code>claimsProperty</code> can change which field in the JWT is matched to the <code>id</code> or <code>externalId</code> on an identity.
<code>useExternalId</code> when true will match the <code>claimsProperty</code> to an identity&#39;s <code>externalId</code> field. If false, it will match
to the <code>id</code> field.</p>
<p><em>Note: <code>externalId</code> values on identities are enforced to be unique.</em></p>
<p><code>claimsProperty</code> can contain JWT standard claims or private claims. An example usage would be an <code>email</code> JWT private
claim and Ziti identities with <code>externalId</code> set to email addresses.</p>
<h2 id="x509-certificate">x509 Certificate</h2>
<p>If the JWT provider has a static x509 certificate, it is possible define an External JWT Signer using the PEM encoded
public certificate of the signer. If the JWT provider has JWKS endpoint support it is strongly recommended to create
an External JWT Signer using the JWKS endpoint. External JWT Signers configured with a static x509 certificate will
need maintenance during key rotation and certificate expiration. For these operations the Edge Management API 
can be used for external automation.</p>
<h2 id="jwks-endpoint">JWKS Endpoint</h2>
<p>JSON Web Key Sets (JWKS) is defined in <a href="https://datatracker.ietf.org/doc/html/rfc7517#section-5">RFC7517 Section 5</a>
and is used by many popular IdPs (Auth0, Okta) in order to enable external JWT verification. External JWT Signers
configured with a JWKS endpoint allows an identity provider to rotate keys and bridge signer certificate expiration
windows.</p>
<h1 id="jwt-validation">JWT Validation</h1>
<p>External JTW Signers are used to validate JWTs for authentication. This validation requires the following:</p>
<ul>
<li>the <code>iss</code> field on the JWT must match the <code>issuer</code> field on the External JWT Signer</li>
<li>the <code>aud</code> field on the JWT must match the <code>audience</code> field on the External JWT Signer</li>
<li>the <code>sub</code> or field defined by <code>claimsProperty</code> must match the <code>id</code> field on an identity (or <code>externalid</code> if <code>useExternal</code> is true)</li>
<li>the JWT must be signed by the x509 certificate or a JWK from the JWKS endpoint defined on the External JWT Signer</li>
<li>the JWT <code>kid</code> must match the External JWT <code>kid</code> field for x509 certificates or the <code>kid</code> in a JWKS response</li>
<li>the JWT must not be expired</li>
</ul>
<h1 id="creation">Creation</h1>
<p>An External JWT Signer that uses a private <code>email</code> claim and matches on <code>externalId</code> with a JWKS endpoint can
be created as follows:</p>
<p><code>POST /edge/management/v1/ext-jwt-signers</code></p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;My External JWT Signer&quot;,
  &quot;enabled&quot;: true,
  &quot;issuer&quot;: &quot;my-issuer&quot;,
  &quot;audience&quot;: &quot;my-audience&quot;,
  &quot;jwksEndpoint&quot;: &quot;https://example.com/.well-known/jwks.json&quot;,
  &quot;claimsProperty&quot;: &quot;email&quot;,
  &quot;useExternalId&quot;: true
}
</code></pre><p>An External JWT Signer that uses the <code>sub</code> claim and matches on <code>id</code> with a x509 certificate can
be created as follows:</p>
<p><code>POST /edge/management/v1/ext-jwt-signers</code></p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;My External JWT Signer&quot;,
  &quot;enabled&quot;: true,
  &quot;issuer&quot;: &quot;my-issuer&quot;,
  &quot;audience&quot;: &quot;my-audience&quot;,
  &quot;kid&quot;: &quot;2gh80220&quot;,
  &quot;certPem&quot;: &quot;-----BEGIN CERTIFICATE-----\nMII...\n-----END CERTIFICATE-----\n&quot;
}
</code></pre><h1 id="external-authentication-url--client-authentication">External Authentication URL &amp; Client Authentication</h1>
<p>Unauthenticated clients can enumerate External JWT Signers that have an <code>externalAuthUrl</code> property. Clients will
receive the name of the External JWT Signer and the <code>externalAuthUrl</code> only. This information can allow clients
to initiate client authentication to the target identity provider. </p>
<p>Example Client External JWT Signer response:</p>
<p><code>GET /edge/client/v1/external-jwt-signers</code></p>
<pre><code class="lang-json">{
  &quot;data&quot;: [
    {
      &quot;_links&quot;: {
        &quot;self&quot;: {
          &quot;href&quot;: &quot;./external-jwt-signers/eZjzX3U1u&quot;
        }
      },
      &quot;id&quot;: &quot;eZjzX3U1u&quot;,
      &quot;name&quot;: &quot;my-ext-jwt-signer&quot;,
      &quot;externalAuthUrl&quot;: &quot;https://my-site/authenticate&quot;
    }
  ],
  &quot;meta&quot;: {}
}
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/openziti/ziti-doc/blob/master/docfx_project/ziti/security/authentication/external-jwt-signers.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span class='pull-left'><span><a href='https://netfoundry.io'>©NetFoundry Inc.</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/privacy-policy'>Privacy Policy</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/legal-items'>Legal</a></span>&nbsp;&nbsp;<span><a href='https://netfoundry.zendesk.com/hc/en-us'>Support</a></span>&nbsp;&nbsp;</span><span class='pull-right'><span><a href='https://www.facebook.com/NetFoundry/' target='_blank'><img height='25' src='/images/fb.svg'></a></span>&nbsp;<span><a href='https://twitter.com/openziti' target='_blank'><img height='25' src='/images/twit.svg'></a></span>&nbsp;<span><a href='https://www.linkedin.com/company/netfoundry/' target='_blank'><img height='25' src='/images/li.svg'></a></span>&nbsp;<span><a href='https://www.youtube.com/channel/UCAsrfQasdZmp2Gq07Ej_5cQ' target='_blank'><img height='25' src='/images/yt.svg'></a></span>&nbsp;&nbsp;&nbsp;</span><br>
<!-- Place this tag in your head or just before your close body tag. -->
<script async="" defer="" src="https://buttons.github.io/buttons.js"></script>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>

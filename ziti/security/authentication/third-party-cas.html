<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>3rd Party CA | Ziti </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="3rd Party CA | Ziti ">
    <meta name="generator" content="docfx 2.x">
    
    <link rel="shortcut icon" href="../../../images/favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
    <!--span>this is text</span-->
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400&amp;display=swap" rel="stylesheet">
    <meta name="google-site-verification" content="jfzf3259Xh6i82RehhnKg4aAsHd02v1MB-jP43wEqHI">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-THVRRJ3GLE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
  
      gtag('config', 'G-THVRRJ3GLE');
    </script>
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../images/ziti-logo-40.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div style="display: flex;">
                    <div class="form-group" style="valign: center;position: relative;">
                      <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                    </div>
                    <div style="position: relative">
                        &nbsp;
                    </div>
                    <div style="position: relative">
                        <a href="https://github.com/openziti">
                            <img src="../../../images/github-white.svg" alt="Star us on GitHub" title="Star us on GitHub" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://openziti.discourse.group">
                            <img src="../../../images/discourse_icon_halo.svg" alt="Start a conversation on Discourse" title="Start a conversation on Discourse" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://twitter.com/openziti">
                            <img src="../../../images/twit.svg" alt="Follow us on Twitter" title="Follow us on Twitter" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://www.youtube.com/channel/UCAsrfQasdZmp2Gq07Ej_5cQ">
                            <img src="../../../images/yt.svg" alt="Watch videos about OpenZiti" title="Watch videos about OpenZiti" height="34px">
                        </a>
                    </div>
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default" name="new">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
          <div style="display:flex; align-items: center; justify-content: center; flex-direction:row; position: relative; width: 100%; text-align: center;     background: rgb(0,104,247);
            background: linear-gradient(90deg, rgba(0,104,247,1) 0%, rgba(222,14,91,1) 100%);">
            <span style="margin-top: 5px; color: white; margin-right: 10px; height:25px">Star us on GitHub</span>
            <span style="margin-top: 5px;"><a class="github-button" href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star openziti/ziti on GitHub">Star</a></span>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="3rd-party-ca">3rd Party CA</h1>

<p>3rd Party CAs allow external private key infrastructures (PKIs) to be imported into Ziti and used for client enrollment
and authentication. Ziti does not allow external private keys from PKIs to be imported for 3rd party CAs. Creation and
distribution of client certificates must be handled outside of Ziti.</p>
<p>3rd Party CAs represent x509 Certificate chains that have the <code>CA:true</code> constraint. It is worth noting
that adding a x509 certificate as a 3rd Party CA will treat it as a trust anchor even if it is an intermediate CA.
3rd Part CAs validate partial chains back to a registered 3rd Party CA. If full chain validation is required, ensure
that the root CA is added as a 3rd Party CA and ensure authenticating clients provide their client certificate in
index zero and any required intermediate certificates afterwards.</p>
<h1 id="usage">Usage</h1>
<p>3rd Party CAs can be used in the following manners:</p>
<ul>
<li>allows clients to enroll and authenticate automatically for at-scale network boarding - <a href="../enrollment/enrollment.html#auto-ca-enrollment">Auto CA Enrollment</a></li>
<li>allows clients to enroll pre-created identities - <a href="../enrollment/enrollment.html#ott-ca-enrollment">OTT CA Enrollment</a></li>
<li>allows clients to map to pre-created identities using <code>externalId</code> and <a href="#external-id--x509-claims">X509 Claims</a></li>
</ul>
<h2 id="create">Create</h2>
<p>Creating a 3rd Party CA has various option that will determine how the 3rd Party CA will be used and how client
certificates will be validated. The following fields configure client authentication:</p>
<ul>
<li><code>isAutoCaEnrollmentEnabled</code> - allows client certificates of the CA to automatically enroll when encountered</li>
<li><code>isOttCaEnrollmentEnabled</code> - allows client certificates of the CA to enroll if an identity with an <code>ottca</code> enrollment was created</li>
<li><code>isAuthEnabled</code> - allows client certificates of the CA to attempt to enroll</li>
<li><code>externalIdClaim</code> - configuration used to pull values out of the x509 client certificate used to match identity <code>externalId</code>, see <a href="#external-id--x509-claims">External Id &amp; x509 Claims</a></li>
</ul>
<p>For <a href="../enrollment/enrollment.html#auto-ca-enrollment">Auto CA Enrollment</a> an identity is created on first authentication. 
The following fields allow configuration of newly created identities:</p>
<ul>
<li><code>identityRoles</code> - the identity roles to give to automatically enrolling identities</li>
<li><code>identityNameFormat</code> - the identity name format used to name <a href="../enrollment/enrollment.html#auto-ca-enrollment">automatically enrolling identities</a></li>
</ul>
<p>On initial creation of a 3rd Party CA it will be in an unverified stated and must undergo <a href="#verification">verification</a>.
The following fields relate to <a href="#verification">verification</a>:</p>
<ul>
<li><code>isVerified</code> - read only field of whether this CA has been verified</li>
<li><code>verificationToken</code> - read only displaying the verification token required to verify the CA</li>
</ul>
<p>All other fields are for informational purposes:</p>
<ul>
<li><code>name</code> - the name of the given CA</li>
<li><code>fingerprint</code> - read only field of the sha1 fingerprint of the provided x509 certificate</li>
<li><code>certPem</code> - PEM encoded version of the CA</li>
</ul>
<h2 id="verification">Verification</h2>
<p>In order for a 3rd Party CA to be used authentication and enrollment it must first be verified. While in an unverified
state <code>isVerfieid</code> will be false and <code>verificationToken</code> will contain a random security token. In order to verify
the 3rd Party CA a certificate with the <code>verificationToken</code> set as the common name must be signed by the certificate
provided for the 3rd Party CA.</p>
<h3 id="ziti-cli">Ziti CLI</h3>
<p>The Ziti CLI can assist with creating a verification certificate in two ways. It can create the verification certificate
and submit it or submit an already created certificate.</p>
<h4 id="create-verification-certificate--submit">Create Verification Certificate &amp; Submit</h4>
<p>Access to the CA&#39;s certificate and private key is required.</p>
<p><code>ziti edge verify ca &lt;name&gt; --cacert &lt;signingCaCert&gt; --cakey &lt;signingCaKey&gt; [--password &lt;caKeyPassword&gt;]</code></p>
<h4 id="submit-verification-certificate">Submit Verification Certificate</h4>
<p>Access to a certificate with the <code>verifiationToken</code> set as the common name and signed by the 3rd Party CA is required</p>
<p><code>ziti edge verify ca &lt;name&gt; --cert &lt;pemCertFile&gt;</code></p>
<h3 id="edge-management-api">Edge Management API</h3>
<p>The <a href="../../apis/edge-apis.html#edge-management-api">Edge Management API</a> accepts and <code>id</code> in the URL path and x509 certificate PEM
as the body:</p>
<p><code>POST /edge/management/v1/cas/&lt;id&gt;/verify</code></p>
<pre><code>—–BEGIN CERTIFICATE—–
MIIDdTCCAl2gAwIBAgILBAAAAAABFUtaw5QwDQYJKoZIhvcNAQEFBQAwVzELMAkG
...
HMUfpIBvFSDJ3gyICh3WZlXi/EjJKSZp4A==
—–END CERTIFICATE—–
</code></pre><h2 id="external-id--x509-claims">External ID &amp; X509 Claims</h2>
<p>The base set of capabilities of x509 certificates do not allow the inclusion of custom private claims. Ziti internally
uses <a href="https://github.com/openziti/x509-claims">x509-claims</a> to allow claims data to be parsed from SANs and other
fields. An example of this in other projects is <a href="https://spiffe.io/">SPIFFE</a>. SPIFFE defines <a href="https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-id">SPIFFE IDs</a>
which are stored in <a href="https://spiffe.io/docs/latest/spiffe-about/spiffe-concepts/#spiffe-verifiable-identity-document-svid">SVIDs</a>.</p>
<p>3rd Party CAs support defining a set of x509 claims configuration that allows a claim to be matched to an identity
<code>externalId</code>. The configuration is contained in an object in the field <code>externalIdClaims</code>. When not defined, x509
client certificate authentication attempts to find an identity that is tied to an <a href="authentication.html#authenticators">authenticator</a> 
by matching client certificates. Using x509 claims, the client is matched by the identity <code>externalId</code> value.</p>
<p>The fields under <code>externalIdClaims</code> is as follows:</p>
<ul>
<li><code>location</code> - defines which value(s) in an x509 certificate will be processed: <code>COMMON_NAME</code>, <code>SAN_URI</code>, <code>SAN_EMAIL</code></li>
<li><code>matcher</code> - defines how values from <code>location</code> will be filtered: <code>ALL</code>, <code>PREFIX</code>, <code>SUFFIX</code>, <code>SCHEME</code></li>
<li><code>matcherCriteria</code> - defines the <code>PREFIX</code>, <code>SUFFIX</code>, or <code>SCHEME</code> to look for based on <code>matcher</code></li>
<li><code>parser</code> - defines how values from <code>location</code> filtered by <code>matcher</code> will be parsed: <code>NONE</code>, <code>SPLIT</code></li>
<li><code>parserCriteria</code> - defines the criteria to provide to <code>parser</code></li>
<li><code>index</code> - should multiple values still be available after <code>location</code>, <code>matcher,</code> and <code>parser</code> processing the integer value here will be used from the set</li>
</ul>
<h4 id="spiffe-example">SPIFFE Example:</h4>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;myCA&quot;,
  &quot;certPem&quot;: &quot;—–BEGIN CERTIFICATE—–\nMIIDdTCCAHMU...\n—–END CERTIFICATE—–&quot;,
  &quot;externalIdClaims&quot;: {
    &quot;location&quot;: &quot;SAN_URI&quot;,
    &quot;matcher&quot;: &quot;SCHEME&quot;,
    &quot;parser&quot;: &quot;NONE&quot;,
    &quot;parserCriteria&quot;: null,
    &quot;index&quot;: 0
  }
}
</code></pre><h3 id="location-matcher-parser">Location, Matcher, Parser</h3>
<p>x509 claims are located, matched, and parsed. Location defines where the value(s) are sourced from, matching filters, 
and parsing allows for a single value to yield multiple claims.</p>
<h4 id="location">Location</h4>
<p>Location configuration sources value(s) from the x509 certificate</p>
<ul>
<li><code>COMMON_NAME</code> - the common name of the certificate</li>
<li><code>SAN_URI</code> - SAN URI fields</li>
<li><code>SAN_EMAIL</code> - SAN email fields</li>
</ul>
<h4 id="matcher--matcher-criteria">Matcher &amp; Matcher Criteria</h4>
<p>Matcher and matcher criteria work together to filter fields. The <code>matcher</code> uses <code>matcherCritera</code> to perform basic
filtering.</p>
<p>Matcher values:</p>
<ul>
<li><code>ALL</code> - returns all values (i.e. no filtering)</li>
<li><code>PREFIX</code> - matches by the string prefix defined by <code>matcherCriteria</code></li>
<li><code>SUFFIX</code> - matched by the string suffix defined by <code>matcherCriteria</code></li>
<li><code>SCHEME</code> - a matcher that specializes in matching the protocol defined in <code>matcherCriteria</code> of  a URI (used with <code>SAN_URI</code> only)</li>
</ul>
<h4 id="parser--parser-criteria">Parser &amp; Parser Criteria</h4>
<p>Parser and parser criteria work together to turn individual values from location and matching into multiple values.
Parsers allow a single value to contain more than one claim.</p>
<p>Parser values:</p>
<ul>
<li><code>NONE</code> - perform no parsing</li>
<li><code>SPLIT</code> - perform string splitting based on the string separator defined by <code>parserCriteria</code></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/openziti/ziti-doc/blob/master/docfx_project/ziti/security/authentication/third-party-cas.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span class='pull-left'><span><a href='https://netfoundry.io'>©NetFoundry Inc.</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/privacy-policy'>Privacy Policy</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/legal-items'>Legal</a></span>&nbsp;&nbsp;<span><a href='https://netfoundry.zendesk.com/hc/en-us'>Support</a></span>&nbsp;&nbsp;</span><span class='pull-right'><span><a href='https://www.facebook.com/NetFoundry/' target='_blank'><img height='25' src='/images/fb.svg'></a></span>&nbsp;<span><a href='https://twitter.com/openziti' target='_blank'><img height='25' src='/images/twit.svg'></a></span>&nbsp;<span><a href='https://www.linkedin.com/company/netfoundry/' target='_blank'><img height='25' src='/images/li.svg'></a></span>&nbsp;<span><a href='https://www.youtube.com/channel/UCAsrfQasdZmp2Gq07Ej_5cQ' target='_blank'><img height='25' src='/images/yt.svg'></a></span>&nbsp;&nbsp;&nbsp;</span><br>
<!-- Place this tag in your head or just before your close body tag. -->
<script async="" defer="" src="https://buttons.github.io/buttons.js"></script>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>

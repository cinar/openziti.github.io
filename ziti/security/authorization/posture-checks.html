<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Posture Checks | Ziti </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Posture Checks | Ziti ">
    <meta name="generator" content="docfx 2.x">
    
    <link rel="shortcut icon" href="../../../images/favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
    <!--span>this is text</span-->
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400&amp;display=swap" rel="stylesheet">
    <meta name="google-site-verification" content="jfzf3259Xh6i82RehhnKg4aAsHd02v1MB-jP43wEqHI">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-THVRRJ3GLE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
  
      gtag('config', 'G-THVRRJ3GLE');
    </script>
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../images/ziti-logo-40.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div style="display: flex;">
                    <div class="form-group" style="valign: center;position: relative;">
                      <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                    </div>
                    <div style="position: relative">
                        &nbsp;
                    </div>
                    <div style="position: relative">
                        <a href="https://github.com/openziti">
                            <img src="../../../images/github-white.svg" alt="Star us on GitHub" title="Star us on GitHub" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://openziti.discourse.group">
                            <img src="../../../images/discourse_icon_halo.svg" alt="Start a conversation on Discourse" title="Start a conversation on Discourse" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://twitter.com/openziti">
                            <img src="../../../images/twit.svg" alt="Follow us on Twitter" title="Follow us on Twitter" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://www.youtube.com/channel/UCAsrfQasdZmp2Gq07Ej_5cQ">
                            <img src="../../../images/yt.svg" alt="Watch videos about OpenZiti" title="Watch videos about OpenZiti" height="34px">
                        </a>
                    </div>
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default" name="new">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
          <div style="display:flex; align-items: center; justify-content: center; flex-direction:row; position: relative; width: 100%; text-align: center;     background: rgb(0,104,247);
            background: linear-gradient(90deg, rgba(0,104,247,1) 0%, rgba(222,14,91,1) 100%);">
            <span style="margin-top: 5px; color: white; margin-right: 10px; height:25px">Star us on GitHub</span>
            <span style="margin-top: 5px;"><a class="github-button" href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star openziti/ziti on GitHub">Star</a></span>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="zitiSecurityPostureChecks">
<h1 id="posture-checks">Posture Checks</h1>

<p>Posture Checks represent environmental state (posture) that an endpoint must be in, in order for a Service Policy to 
grant access to a service as either a client or host. Posture Checks are defined separately from Service Policies and 
assigned to them via attributes on the Posture Checks and attribute selectors on the Service Policy. This allows Posture
Checks to be re-used.</p>
<h1 id="posture-data">Posture Data</h1>
<p>Environmental state is saved as Posture Data - a set of values describing environmental state. Posture Data is provided 
to the controller via Posture Response sent from the client. Posture Responses are constructed from Posture Queries 
which are reported to the client per service from the controller.</p>
<p><a href="https://mermaid.live/edit#pako:eNptkMtuAjEMRX9l5BWo8ANZsJl210XVkdgQFunkto2aBzgOEkL8e4PIICTwypLPsa98ojFZkKKMfUEc8erMD5ugY1er9w5RlqvVS5-icPIerLp3l2UAH9yIPJs38jav9PLqqW6znbiHfY3oGUZQwY-UpTA-kXcp5ifCXYChfAUns0fpeZg7c228s_VgE6f0U9GCAjgYZ-tHTpeZJvlFgCZVW2v4T5OO58qV3WXPm3WSmNS38RkLMkXScIwjKeGCCWovbdT5H_eEfjA"><img src="https://mermaid.ink/img/pako:eNptkMtuAjEMRX9l5BWo8ANZsJl210XVkdgQFunkto2aBzgOEkL8e4PIICTwypLPsa98ojFZkKKMfUEc8erMD5ugY1er9w5RlqvVS5-icPIerLp3l2UAH9yIPJs38jav9PLqqW6znbiHfY3oGUZQwY-UpTA-kXcp5ifCXYChfAUns0fpeZg7c228s_VgE6f0U9GCAjgYZ-tHTpeZJvlFgCZVW2v4T5OO58qV3WXPm3WSmNS38RkLMkXScIwjKeGCCWovbdT5H_eEfjA" alt=""></a></p>
<h1 id="evaluation">Evaluation</h1>
<p>Posture Checks are event based and are evaluated as events are encountered. Once evaluated failure states begin
to restrict access as Service Policies being to fail their associated Posture Checks. One exception to this
is the <a href="#mfa">MFA Posture Check</a> which has grace periods for some scenarios.</p>
<h1 id="access">Access</h1>
<p>A single Service may be granted to a client through multiple Service Policies. Only one of those policies needs to be
in a passing state for access to be granted. For example creating two Service Policies, one with Posture Checks and
one without, to the same service and client will result in the client always having access. This is because one
Service Policy lacking Posture Checks will always result as passing.</p>
<h1 id="associating">Associating</h1>
<p>Posture Checks are associated to <a href="policies/overview.html">Service Policies</a> through 
<a href="policies/overview.html#roles-and-role-attributes">Roles and Role Attributes</a>. Attributes on each Posture Check created
will be selected for on Service Policies via the <code>postureCheckRoles</code> as an array of selected roles. Service Policies are
associated to Identities in the same fashion via <code>identityRoles</code> and the attributes on Identities.</p>
<h1 id="types">Types</h1>
<p>The following Posture Check types are currently defined:</p>
<ul>
<li><a href="#os-os-version">OS / OS Version</a> - requires a specific operating system and optionally a specific version or versions</li>
<li><a href="#mac-address">MAC Address</a> - requires the client has a specific MAC address associated with its hardware</li>
<li><a href="#mfa">MFA</a> - requires the client currently has MFA TOTP enabled</li>
<li><a href="#multi-process">Multi Process</a> - requires a client be running one or more applications</li>
<li><a href="#windows-domain">Windows Domain</a> - requires the client be a member of a specific domain</li>
</ul>
<h2 id="os-os-version">OS/ OS Version</h2>
<p>The <code>OS</code> Posture Check type is used to verify a client&#39;s operating system and optionally version</p>
<p>Supported OS Types</p>
<ul>
<li>Windows</li>
<li>Windows Server</li>
<li>Linux</li>
<li>MaxOc</li>
<li>iOS</li>
<li>Android</li>
</ul>
<p>Versions may be validated with any valid <a href="https://semver.org/">Semver 2.0</a> statement. This includes the ability to
specify ranges by major, minor, and patch levels. Operating systems that do not have an explicit patch level, their
build number will be used instead.</p>
<h3 id="semver-examples">Semver Examples</h3>
<ul>
<li><code>&gt;=1.2.7 &lt;1.3.0</code> would match the versions 1.2.7, 1.2.8, and 1.2.99, but not the versions 1.2.6, 1.3.0, or 1.1.0</li>
<li><code>&gt;=1.2.7</code> would match the versions 1.2.7, 1.2.8, 2.5.3, and 1.3.9, but not the versions 1.2.6 or 1.1.0</li>
<li><code>1.2.7 || &gt;=1.2.9 &lt;2.0.0</code> would match the versions 1.2.7, 1.2.9, and 1.4.6, but not the versions 1.2.8 or 2.0.0</li>
</ul>
<h3 id="creating">Creating</h3>
<h4 id="ziti-cli">Ziti CLI</h4>
<p><code>ziti edge create posture-check os windows-and-android -o &quot;WINDOWS:&gt;10.0.0,ANDROID:&gt;6.0.0&quot; -a check-attribute1</code></p>
<h4 id="edge-management-api">Edge Management API</h4>
<p><code>POST /edge/management/v1/posture-checks</code></p>
<pre><code class="lang-json">{
  &quot;typeId&quot;: &quot;OS&quot;,
  &quot;name&quot;: &quot;windows-and-android&quot;,
  &quot;operatingSystems&quot;: [
    {
      &quot;type&quot;: &quot;WINDOWS&quot;,
      &quot;versions&quot;: [&quot;&gt;10.0.0&quot;]

    },
    {
      &quot;type&quot;: &quot;ANDROID&quot;,
      &quot;versions&quot;: [&quot;&gt;6.0.0&quot;]
    }
  ],
  &quot;attributes&quot;: [&quot;check-attribute1&quot;]
}
</code></pre><h2 id="mac-address">MAC Address</h2>
<p>The <code>MAC</code> Posture Check type is used to verify a client&#39;s network interface cards MAC addresses. MAC Addresses
that are not specified will fail the check.</p>
<h3 id="creating-1">Creating</h3>
<h4 id="ziti-cli-1">Ziti CLI</h4>
<p><code>ziti edge create posture-check mac mac-lsit =m &quot;14-B2-2C-E5-F0-61&quot; -m &quot;D5-22-E8-B7-FF-48&quot; -m &quot;...&quot;  -a check-attribute1</code></p>
<h4 id="edge-management-api-1">Edge Management API</h4>
<p><code>POST /edge/management/v1/posture-checks</code></p>
<pre><code class="lang-json">{
  &quot;typeId&quot;: &quot;MAC&quot;,
  &quot;name&quot;: &quot;mac-list&quot;,
  &quot;macAddresses&quot;: [&quot;14-B2-2C-E5-F0-61&quot;, &quot;D5-22-E8-B7-FF-48&quot;, &quot;...&quot;],
  &quot;attributes&quot;: [&quot;check-attribute1&quot;]
}
</code></pre><h2 id="mfa">MFA</h2>
<p>The <code>MFA</code> Posture Check type is used to enforce <a href="../authentication/totp.html">MFA TOTP</a> configuration on a client. Posture
Checks enforce access authorization. For authentication enforcement, see 
<a href="../authentication/authentication-policies.html#secondary">Authentication Policies</a>.</p>
<h3 id="creating-2">Creating</h3>
<p>MFA Posture Checks also support forcing a client to re-submit a valid TOTP on timeout, after locking/unlocking a
device, or waking a device from sleep.</p>
<p>Timeouts are set through the <code>timeoutSeconds</code> property. Where values <code>0</code> and <code>-1</code> represent no timeout.</p>
<p>Forcing submission on lock/unlock is set through <code>promptOnUnlock</code> as <code>true</code> or <code>false</code>. After an unlock event the client
is given a five-minute grace period before the posture check begins to fail.</p>
<p>Forcing submission on wake is set through <code>promptOnWake</code> as <code>true</code> or <code>false</code>. After a wake event the client
is given a five-minute grace period before the posture check begins to fail.</p>
<h4 id="ziti-cli-2">Ziti CLI</h4>
<p><code>ziti edge create posture-check mfa my-mfa-check -s 3600 -w -u -a check-attribute1</code></p>
<h4 id="edge-management-api-2">Edge Management API</h4>
<p><code>POST /edge/management/v1/posture-checks</code></p>
<pre><code class="lang-json">{
  &quot;typeId&quot;: &quot;MFA&quot;,
  &quot;timeoutSeconds&quot;: 3600,
  &quot;promptOnWake&quot;: false,
  &quot;promptOnUnlock&quot;: false,
  &quot;attributes&quot;: [&quot;check-attribute1&quot;]
}
</code></pre><h2 id="multi-process">Multi Process</h2>
<p>The <code>MULTI_PROCESS</code> Posture Check is used to verify that one or more programs are running on the client. It can 
optionally check sha256 hash as well as digital signers on Window.</p>
<h3 id="creating-3">Creating</h3>
<p>Multi Process Posture Checks allow multiple processes to be defined which either all of must be running or one of must
be running. The <code>semantic</code> of the check determines how the processes are evaluated. <code>AllOf</code> requires that all
processes define in the check must be running. <code>OneOf</code> requires only one of the processes to be valid.</p>
<p>All processes are checked to be running from the binary provided in the <code>path</code> setting.</p>
<p>Valid sha256 hashes of a binary may be provided in the <code>hashes</code>.</p>
<p>If the file is digital signed (Windows only) the <code>signerFingerprints</code> may be provided. Signer fingerprints are the 
sha1 fingerprints (thumbprints) of valid signing certificates.</p>
<h4 id="ziti-cli-3">Ziti CLI</h4>
<p><code>ziti edge create posture-check process-multi my-proc-multi AnyOf &quot;Windows,Linux&quot;, &quot;C:\\program1.exe,/usr/local/program1&quot; -a check-attribute1</code></p>
<h4 id="edge-management-api-3">Edge Management API</h4>
<p><code>POST /edge/management/v1/posture-checks</code></p>
<pre><code class="lang-json">{
  &quot;typeId&quot;: &quot;PROCESS_MULTI&quot;,
  &quot;name&quot;: &quot;my-proc-multi&quot;,
  &quot;semantic&quot;: &quot;OneOf&quot;,
  &quot;processes&quot;: [
    {
      &quot;os&quot;: &quot;WINDOWS&quot;,
      &quot;path&quot;: &quot;C:\\program1.exe&quot;,
      &quot;hashes&quot;: [&quot;421c76d77563afa1914846b010bd164f395bd34c2102e5e99e0cb9cf173c1d87&quot;],
      &quot;signerFingerprints&quot;: [&quot;79437f5edda13f9c0669b978dd7a9066dd2059f1&quot;]
    },
    {
      &quot;os&quot;: &quot;LINUX&quot;,
      &quot;path&quot;: &quot;/usr/local/program1&quot;,
      &quot;hashes&quot;: [&quot;b16d66911a4657945bf1929bc1a9d743168b819d9b19d1519eb29ffb3db140a4&quot;],
      &quot;signerFingerprints&quot;: [&quot;882106ca75dc47a5ffd055e640b30c2e01789521&quot;]
    }
  ],
  &quot;attributes&quot;: [&quot;check-attribute1&quot;]
}
</code></pre><h2 id="windows-domain">Windows Domain</h2>
<p>The <code>DOMAIN</code> Posture CHeck is used to verify that a Windows client has joined a specific Windows Domain.</p>
<h3 id="creating-4">Creating</h3>
<h4 id="ziti-cli-4">Ziti CLI</h4>
<p><code>ziti edge create posture-check domain domain-list -d domain1 -d &quot;domain2&quot;  -a check-attribute1</code></p>
<h4 id="edge-management-api-4">Edge Management API</h4>
<p><code>POST /edge/management/v1/posture-checks</code></p>
<pre><code class="lang-json">{
  &quot;typeId&quot;: &quot;DOMAIN&quot;,
  &quot;name&quot;: &quot;domain-list&quot;,
  &quot;macAddresses&quot;: [&quot;domain1&quot;, &quot;domain2&quot;],
  &quot;attributes&quot;: [&quot;check-attribute1&quot;]
}
</code></pre><h1 id="viewing-identity-posture-data">Viewing Identity Posture Data</h1>
<p>For troubleshooting purposes it is possible to view an identity&#39;s current Posture Data.</p>
<h4 id="request">Request</h4>
<p><code>GET /edge/management/v1/identities/&lt;id&gt;/posture-data</code></p>
<pre><code>&lt;empty body&gt;
</code></pre><h4 id="response">Response</h4>
<pre><code class="lang-json">{
  &quot;data&quot;: {
    &quot;apiSessionPostureData&quot;: {},
    &quot;domain&quot;: {
      &quot;lastUpdatedAt&quot;: &quot;2022-08-03T11:03:29.451Z&quot;,
      &quot;postureCheckId&quot;: &quot;-GIxFATMg&quot;,
      &quot;timedOut&quot;: false,
      &quot;domain&quot;: &quot;MYDOMAIN&quot;
    },
    &quot;mac&quot;: {
      &quot;lastUpdatedAt&quot;: null,
      &quot;postureCheckId&quot;: &quot;&quot;,
      &quot;timedOut&quot;: false,
      &quot;addresses&quot;: null
    },
    &quot;os&quot;: {
      &quot;lastUpdatedAt&quot;: &quot;2022-08-03T11:03:29.375Z&quot;,
      &quot;postureCheckId&quot;: &quot;OZimG0oGR&quot;,
      &quot;timedOut&quot;: false,
      &quot;build&quot;: null,
      &quot;type&quot;: &quot;windows&quot;,
      &quot;version&quot;: &quot;10.0.19044&quot;
    },
    &quot;processes&quot;: [
      {
        &quot;lastUpdatedAt&quot;: &quot;2022-08-03T11:03:49.803Z&quot;,
        &quot;postureCheckId&quot;: &quot;62yttIAeJ&quot;,
        &quot;timedOut&quot;: false,
        &quot;signerFingerprints&quot;: []
      },
      {
        &quot;lastUpdatedAt&quot;: &quot;2022-08-03T11:03:49.986Z&quot;,
        &quot;postureCheckId&quot;: &quot;Gh5DOegtE&quot;,
        &quot;timedOut&quot;: false,
        &quot;signerFingerprints&quot;: []
      }
    ]
  },
  &quot;meta&quot;: {}
}
</code></pre><h1 id="viewing-failed-service-requests">Viewing Failed Service Requests</h1>
<p>For troubleshooting purposes it is possible to view the last fifty failed service requests due to Posture Check failure.</p>
<h4 id="request-1">Request</h4>
<p><code>GET /edge/management/v1/identities/&lt;id&gt;/failed-service-requests</code></p>
<pre><code>&lt;empty body&gt;
</code></pre><h4 id="response-1">Response</h4>
<pre><code class="lang-json">{
  &quot;meta&quot;: {},
  &quot;data&quot;: [
    {
      &quot;apiSessionId&quot;: &quot;ckytwv9811tqz15mzoyfi1uvb&quot;,
      &quot;policyFailures&quot;: [
        {
          &quot;policyId&quot;: &quot;Nk43EwJKE&quot;,
          &quot;policyName&quot;: &quot;TestPolicy1&quot;,
          &quot;checks&quot;: [
            {
              &quot;actualValue&quot;: {
                &quot;passedMfa&quot;: false,
                &quot;passedOnUnlock&quot;: false
              },
              &quot;expectedValue&quot;: {
                &quot;passedMfa&quot;: true,
                &quot;passedOnWake&quot;: true
              },
              &quot;postureCheckId&quot;: &quot;5Ucbw.tjo0&quot;,
              &quot;postureCheckName&quot;: &quot;TestCheck1&quot;,
              &quot;postureCheckType&quot;: &quot;MFA&quot;
            }
          ]
        }
      ],
      &quot;serviceId&quot;: &quot;iGoRLhrx0&quot;,
      &quot;serviceName&quot;: &quot;TestService1&quot;,
      &quot;sessionType&quot;: &quot;Dial&quot;,
      &quot;when&quot;: &quot;2022-01-25T10:18:45.257Z&quot;
    }
  ]
}
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/openziti/ziti-doc/blob/master/docfx_project/ziti/security/authorization/posture-checks.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span class='pull-left'><span><a href='https://netfoundry.io'>©NetFoundry Inc.</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/privacy-policy'>Privacy Policy</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/legal-items'>Legal</a></span>&nbsp;&nbsp;<span><a href='https://netfoundry.zendesk.com/hc/en-us'>Support</a></span>&nbsp;&nbsp;</span><span class='pull-right'><span><a href='https://www.facebook.com/NetFoundry/' target='_blank'><img height='25' src='/images/fb.svg'></a></span>&nbsp;<span><a href='https://twitter.com/openziti' target='_blank'><img height='25' src='/images/twit.svg'></a></span>&nbsp;<span><a href='https://www.linkedin.com/company/netfoundry/' target='_blank'><img height='25' src='/images/li.svg'></a></span>&nbsp;<span><a href='https://www.youtube.com/channel/UCAsrfQasdZmp2Gq07Ej_5cQ' target='_blank'><img height='25' src='/images/yt.svg'></a></span>&nbsp;&nbsp;&nbsp;</span><br>
<!-- Place this tag in your head or just before your close body tag. -->
<script async="" defer="" src="https://buttons.github.io/buttons.js"></script>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>

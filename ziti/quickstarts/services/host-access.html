<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Your First Service - Zero Trust Host Access | Ziti </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Your First Service - Zero Trust Host Access | Ziti ">
    <meta name="generator" content="docfx 2.x">
    
    <link rel="shortcut icon" href="../../../images/favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
    <!--span>this is text</span-->
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400&amp;display=swap" rel="stylesheet">
    <meta name="google-site-verification" content="jfzf3259Xh6i82RehhnKg4aAsHd02v1MB-jP43wEqHI">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-THVRRJ3GLE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
  
      gtag('config', 'G-THVRRJ3GLE');
    </script>
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../images/ziti-logo-40.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div style="display: flex;">
                    <div class="form-group" style="valign: center;position: relative;">
                      <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                    </div>
                    <div style="position: relative">
                        &nbsp;
                    </div>
                    <div style="position: relative">
                        <a href="https://github.com/openziti">
                            <img src="../../../images/github-white.svg" alt="Star us on GitHub" title="Star us on GitHub" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://openziti.discourse.group">
                            <img src="../../../images/discourse_icon_halo.svg" alt="Start a conversation on Discourse" title="Start a conversation on Discourse" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://twitter.com/openziti">
                            <img src="../../../images/twit.svg" alt="Follow us on Twitter" title="Follow us on Twitter" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://www.youtube.com/channel/UCAsrfQasdZmp2Gq07Ej_5cQ">
                            <img src="../../../images/yt.svg" alt="Watch videos about OpenZiti" title="Watch videos about OpenZiti" height="34px">
                        </a>
                    </div>
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default" name="new">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
          <div style="display:flex; align-items: center; justify-content: center; flex-direction:row; position: relative; width: 100%; text-align: center;     background: rgb(0,104,247);
            background: linear-gradient(90deg, rgba(0,104,247,1) 0%, rgba(222,14,91,1) 100%);">
            <span style="margin-top: 5px; color: white; margin-right: 10px; height:25px">Star us on GitHub</span>
            <span style="margin-top: 5px;"><a class="github-button" href="https://github.com/openziti/ziti" data-icon="octicon-star" data-show-count="true" aria-label="Star openziti/ziti on GitHub">Star</a></span>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="your-first-service---zero-trust-host-access">Your First Service - Zero Trust Host Access</h1>

<p>This document will demonstrate how to successfully deploy and secure an existing, &quot;brown field&quot; application using OpenZiti. You want to 
secure an application where you don&#39;t control the source or where you don&#39;t want to (or cannot) integrate an OpenZiti SDK into the 
application. These sorts of services are often web-based, so we&#39;ll focus here at exposing a web server. It&#39;s important to keep in mind 
that OpenZiti is a holistic zero trust networking solution. You can absolutely expose applications that are not web-based. For now, we&#39;ll start with a web server since that&#39;s a common need. </p>
<hr>
<h2 id="solution-overview">Solution Overview</h2>
<p>Before we get into using OpenZiti, let&#39;s take a moment and review what the solution is like before we apply any zero trust networking 
principles. We will use some sort of http client, connect it over a network. The exact network does not matter. OpenZiti is applicable 
to any network be it host network, local network, the internet, private network, etc. </p>
<h3 id="simple-http-solution-overview---before-zitibr">Simple HTTP Solution Overview - Before Ziti<br></h3>
<p><img src="before-openziti.png" alt="before OpenZiti"></p>
<p>The important aspect of this diagram is to notice that the HTTP server is provisioned on the <a href="../../../glossary/glossary.html#underlay">underlay</a>
network and requires a hole through the firewall to allow clients to connect.</p>
<h3 id="simple-http-solution---after-ziti">Simple HTTP Solution - After Ziti</h3>
<p><img src="after-openziti.png" alt="after OpenZiti"></p>
<p>After OpenZiti, we can see that there is no longer an open firewall to allow access to the HTTP server. Instead, the HTTP client 
will have its network requests intercepted by an OpenZiti tunneller. Once intercepted, the packets are then delivered to the OpenZiti
<a href="../../../glossary/glossary.html#network-overlay-overlay">overlay</a> fabric which has the responsibility to deliver the intercepted packets to the
target identity. Once delivered to the target identity, in this example, the traffic will offload back to the underlay network to be 
sent to the final destination: the HTTP Server.</p>
<p>With an understanding of what we are looking to accomplish in this guide, let&#39;s get into it!</p>
<hr>
<h2 id="implementing-the-service">Implementing the Service</h2>
<h3 id="prerequisite---openziti-network">Prerequisite - OpenZiti Network</h3>
<p>You will need an OpenZiti overlay network in place before you can complete this guide. If you do not have an
OpenZiti overlay network provisioned yet, <a href="../quickstart-overview.html">follow a quickstart</a> and get a network up and running.</p>
<h3 id="prerequisite---http-server">Prerequisite - HTTP Server</h3>
<p>You&#39;ll need an HTTP server which you plan to connect your HTTP client to. There are numerous ways to 
bring an HTTP server online but for this guide I have chosen to use docker and deploy a very simple HTTP application. The server will 
simply print out the &quot;docker whale&quot; when it&#39;s connected to. (This guide will not teach you how to install docker, nor how to install an 
HTTP server which is listening)  If you are familiar with docker and wish to use the exact same example as shown here, simply run the 
container with: <code>docker run -d --rm --name web-test -p 80:8000 crccheck/hello-world</code>. </p>
<p>Alternatively, if you have used the <a href="../network/local-docker-compose.html">docker-compose quickstart</a> to provision your 
OpenZiti overlay network, you will have this HTTP server available to use immediately. </p>
<h3 id="prerequisite---http-client-tunneller">Prerequisite - HTTP Client Tunneller</h3>
<p>You will need to install an <a href="../../clients/tunneler.html">OpenZiti tunneller</a> on the machine which represents the HTTP client. Later on 
we&#39;ll create an identity for this tunneller and use the identity to access the HTTP server. </p>
<h3 id="prerequisite---http-server-tunneller">Prerequisite - HTTP Server Tunneller</h3>
<p>You will need to install an <a href="../../clients/tunneler.html">OpenZiti tunneller</a> on the machine which represents the HTTP server. Later on
we&#39;ll create an identity for this tunneller and use the identity to access the HTTP server. </p>
<div class="NOTE"><h5>Note</h5><p>If you used the docker-compose quickstart the &quot;private&quot; edge routers are configured as tunnelers and will not require you to deploy 
another tunneler nor will you need to create another identity.</p>
</div>
<h3 id="prerequisite---cli">Prerequisite - CLI</h3>
<p>If you plan to use the <code>ziti</code> CLI tool, you will either need to download and get the <code>ziti</code> executable on your path. If you have 
followed a quickstart, this will have been done for you and the executable will be located in <code>~/.ziti/quickstart/$(hostname)/ziti-bin/</code>.
Also, the .env file the quickstart emits can be used to put this folder on your path by simply sourcing that file. For example, if you
followed either the <a href="../network/local-no-docker.html">Local - No Docker</a> or 
<a href="../network/hosted.html">Host Ziti Anywhere</a> quickstart, you should have a file that can be sourced. Here is an example of 
my personal &quot;Local - No Docker&quot; result when sourcing that file:</p>
<pre><code class="lang-text">$ source ~/.ziti/quickstart/$(hostname)/$(hostname).env

adding /home/cd/.ziti/quickstart/sg3/ziti-bin/ziti-v0.25.6 to the path
</code></pre><p>If you are using a docker-based example you can exec into the controller where the <code>ziti</code> CLI tool will be available and this file will 
be sourced for you as well. Here&#39;s an example when I use docker to exec into my controller locally:</p>
<pre><code class="lang-text">$ docker exec -it docker_ziti-controller_1 bash

adding /openziti/ziti-bin to the path
</code></pre><hr>
<h3 id="configuring-the-overlay---overview">Configuring the Overlay - Overview</h3>
<p>With our overlay network ready and with two tunneling applications deployed and ready to be used, we can start to configure our solution.</p>
<p>Here is an overview of the steps we will follow:</p>
<ol>
<li>Create an identity for the HTTP client and assign an attribute &quot;http-clients&quot;. We&#39;ll use this attribute when authorizing the clients to
access the HTTP service</li>
<li>Create an identity for the HTTP server if you are not using an edge-router with the tunneling option enabled (see below). Also note 
that if you are using the docker-compose quickstart or just plan to use an edge-router with tunneling enabled you can also skip this 
step.</li>
<li>Create an <a href="../../config-store/overview.html">intercept.v1 config</a>. This config is used to instruct the client-side tunneler how 
to correctly intercept the targeted traffic and put it onto the overlay.</li>
<li>Create a <a href="../../config-store/overview.html">host.v1 config</a>. This config is used instruct the server-side tunneler how to offload the 
traffic from the overlay, back to the underlay.</li>
<li>Create a service to associate the two configs created previously into a service.</li>
<li>Create a service-policy to authorize &quot;HTTP Clients&quot; to &quot;dial&quot; the service representing the HTTP server.</li>
<li>Create a service-policy to authorize the &quot;HTTP Server&quot; to &quot;bind&quot; the service representing the HTTP server.</li>
<li>Start the server-side tunneller (unless using the docker-compose quickstart) with the HTTP server identity, providing access to the 
HTTP server.</li>
<li>Start the client-side tunneller using the HTTP client identity.</li>
<li>Access the HTTP server securely over the OpenZiti zero trust overlay</li>
</ol>
<p>We can do all these steps using the OpenZiti CLI tool: <code>ziti</code>. We can also accomplish this using the OpenZiti Admin Console. We&#39;ll 
demonstrate doing it both ways now.</p>
<h3 id="configuring-the-overlay-using-ziti-cli">Configuring the Overlay Using Ziti CLI</h3>
<p>Here you can find the steps necessary to configure your overlay network. You can copy/paste and run them all at once, or you can go 
slowly and run one command at a time to see how each command works. These commands are all based on a shell similar to bash. If you are 
not using bash you&#39;ll need to adapt these scripts to your shell.</p>
<h4 id="http-server-ipdns">HTTP Server IP/DNS</h4>
<p>Note that step 4 below requires you to have set the variable named <code>http_server</code>. This variable represents the location of the HTTP 
server relative to the OpenZiti tunneler you&#39;re using. Look at the diagram above. You will want to supply the IP/FQDN of the server 
which runs the HTTP server that is relative to the tunneler. As an example, if you were to use the docker-compose quickstart and are 
going to reference the pre-deployed HTTP server that comes with it, you&#39;d set <code>http_server</code> to <code>web-test-blue</code> since that is a valid 
name of the container running the HTTP server.</p>
<h4 id="http-server-identity">HTTP Server Identity</h4>
<p>Note that step 7 below requires you to have set the variable named <code>http_server_id</code>. All of the quickstarts provision an edge-router 
with the tunneler option (<code>-t</code>) enabled. This means that edge-router is configured to serve as a tunneller. Run <code>ziti edge list 
identities</code> to find the name of the identity associated to the router.</p>
<pre><code class="lang-bash"># login to your controller - replace the host/port with the correct value
ziti edge login localhost:1280

# optional login: 
# if you&#39;re using docker and have exec&#39;ed into your controller using docker you should be able to run the alias `zitiLogin` to login
# optional login:
# if you&#39;ve sourced the .env file from a quickstart you should be able to run the alias `zitiLogin` to login

# 1. Create an identity for the HTTP client and assign an attribute &quot;http-clients&quot;. We&#39;ll use this attribute when authorizing the clients to
#  access the HTTP service
ziti edge create identity user http-client -a &#39;http-clients&#39; -o http.client.jwt 

#2. Create an identity for the HTTP server if you are not using an edge-router with the tunneling option enabled
ziti edge create identity user http-server -o http.server.jwt

#3. Create an intercept.v1 config. This config is used to instruct the client-side tunneler how to correctly intercept 
#   the targeted traffic and put it onto the overlay.
ziti edge create config http.intercept.v1 intercept.v1 &#39;{&quot;protocols&quot;:[&quot;tcp&quot;],&quot;addresses&quot;:[&quot;http.ziti&quot;], &quot;portRanges&quot;:[{&quot;low&quot;:80, &quot;high&quot;:80}]}&#39;

#4. Create a host.v1 config. This config is used instruct the server-side tunneler how to offload the traffic from 
#   the overlay, back to the underlay.
ziti edge create config http.host.v1 host.v1 &#39;{&quot;protocol&quot;:&quot;tcp&quot;, &quot;address&quot;:&quot;&#39;&quot;${http_server}&quot;&#39;&quot;, &quot;port&quot;:8000}&#39;

#5. Create a service to associate the two configs created previously into a service.
ziti edge create service http.svc --configs http.intercept.v1,http.host.v1

#6. Create a service-policy to authorize &quot;HTTP Clients&quot; to &quot;dial&quot; the service representing the HTTP server.
ziti edge create service-policy http.policy.dial Dial --service-roles &quot;@http.svc&quot; --identity-roles &#39;#http-clients&#39;

#7. Create a service-policy to authorize the &quot;HTTP Server&quot; to &quot;bind&quot; the service representing the HTTP server.
ziti edge create service-policy http.policy.bind Bind --service-roles &#39;@http.svc&#39; --identity-roles &quot;@${http_server_id}&quot;

#8. Start the server-side tunneller (unless using the docker-compose quickstart) with the HTTP server identity.
#   [optional] if you don&#39;t use an edge-router as your tunneler, you will need to download and run the tunneler for your OS
#   if you are using a ziti-router, skip to step 9 below
# 
#   This step is dependant on platform. For this demo we&#39;ll be using a virtual machine running linux and we&#39;ll be using the
#   ziti-edge-tunnel binary. Copy the http.server.jwt from step 2 to the server machine. For the example we&#39;ll use /tmp/http.server.jwt
#
# enroll the server identity using ziti-edge-tunnel
./ziti-edge-tunnel enroll --jwt /tmp/http.server.jwt --identity /tmp/http.server.json
# run ziti-edge-tunnel for the client
sudo ./ziti-edge-tunnel run -i /tmp/http.server.json

#9. Start the client-side tunneller using the HTTP client identity.
#   This step is dependant on platform. For this demo we&#39;ll be using a virtual machine running linux and we&#39;ll be using the
#   ziti-edge-tunnel binary. Copy the http.client.jwt from step 1 to the client machine. For the example we&#39;ll use /tmp/http.client.jwt
#
# enroll the client identity using ziti-edge-tunnel
./ziti-edge-tunnel enroll --jwt /tmp/http.client.jwt --identity /tmp/http.client.json
# run ziti-edge-tunnel for the client
sudo ./ziti-edge-tunnel run -i /tmp/http.client.json

#10. Access the HTTP server securely over the OpenZiti zero trust overlay
curl http.ziti
&lt;pre&gt;
Hello World


                                       ##         .
                                 ## ## ##        ==
                              ## ## ## ## ##    ===
                           /&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;\___/ ===
                      ~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~
                           \______ o          _,/
                            \      \       _,&#39;
                             `&#39;--.._\..--&#39;&#39;
&lt;/pre&gt;
</code></pre><h3 id="configuring-the-overlay-using-ziti-admin-console">Configuring the Overlay Using Ziti Admin Console</h3>
<p>-- COMING SOON --</p>
<h3 id="testing-everything-works">Testing Everything Works</h3>
<p>Once you have set everything up As shown in the last step above - at this point you should be able to run a curl statement or use a 
browser to access &quot;http.ziti&quot;.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/openziti/ziti-doc/blob/master/docfx_project/ziti/quickstarts/services/host-access.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span class='pull-left'><span><a href='https://netfoundry.io'>©NetFoundry Inc.</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/privacy-policy'>Privacy Policy</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/legal-items'>Legal</a></span>&nbsp;&nbsp;<span><a href='https://netfoundry.zendesk.com/hc/en-us'>Support</a></span>&nbsp;&nbsp;</span><span class='pull-right'><span><a href='https://www.facebook.com/NetFoundry/' target='_blank'><img height='25' src='/images/fb.svg'></a></span>&nbsp;<span><a href='https://twitter.com/openziti' target='_blank'><img height='25' src='/images/twit.svg'></a></span>&nbsp;<span><a href='https://www.linkedin.com/company/netfoundry/' target='_blank'><img height='25' src='/images/li.svg'></a></span>&nbsp;<span><a href='https://www.youtube.com/channel/UCAsrfQasdZmp2Gq07Ej_5cQ' target='_blank'><img height='25' src='/images/yt.svg'></a></span>&nbsp;&nbsp;&nbsp;</span><br>
<!-- Place this tag in your head or just before your close body tag. -->
<script async="" defer="" src="https://buttons.github.io/buttons.js"></script>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>

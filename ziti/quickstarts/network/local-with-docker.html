<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Local - With Docker | Ziti </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Local - With Docker | Ziti ">
    <meta name="generator" content="docfx 2.x">
    
    <link rel="shortcut icon" href="../../../images/favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
    <!--span>this is text</span-->
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400&amp;display=swap" rel="stylesheet">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../images/ziti-logo-40.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div style="display: flex;">
                    <div class="form-group" style="valign: center;position: relative;">
                      <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                    </div>
                    <div style="position: relative">
                        &nbsp;
                    </div>
                    <div style="position: relative">
                        <a href="https://github.com/openziti">
                            <img src="../../../images/github-white.svg" alt="view us on github" title="view us on github" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://openziti.discourse.group">
                            <img src="../../../images/discourse_icon_halo.svg" alt="Start a conversation on Discourse" title="Start a conversation on Discourse" height="34px">
                        </a>
                    </div>
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="local---with-docker">Local - With Docker</h1>

<p><a href="https://www.docker.com">Docker</a> is a popular container engine and many developers enjoy using solutions delivered via
docker. Ziti provides a single docker container which contains the entire stack of Ziti components. This is not the most
common mechanism for deploying containers, we recognize that. However, we think that this makes it a bit easier for
people to get started with deploying Ziti components using docker. We will certainly look to create individual
containers for each component in the future but for now it&#39;s a single container. You can get this container by issuing
<code>docker pull openziti/quickstart:latest</code>.</p>
<h2 id="starting-the-controller">Starting the Controller</h2>
<p>All <a class="xref" href="../../overview.html#overview-of-a-ziti-network">Ziti Networks</a> require
a <a href="../../manage/controller.html">Ziti Controller</a>. Without a controller, edge routers won&#39;t be able to authorize new
connections rendering a new network useless. You must have a controller running.</p>
<h3 id="required---volume-mount">Required - Volume Mount</h3>
<p>Running Ziti locally via docker will require you to mount a common folder which will be used to store the PKI of your
network. Without a volume mount, you&#39;ll be forced to &#39;figure out&#39; how to get the PKI in place correctly. While this is a
straightforward process once you know how to do it, when you&#39;re getting started this is undoubtedly complicated. We
recommend that if you&#39;re starting out (or if you just don&#39;t want to be bothered with these details) you should just
create a folder and volume mount that folder. It&#39;s expected that this volume mount map to <code>/openziti/pki</code> inside the
container.</p>
<h3 id="required---known-name">Required - Known Name</h3>
<p>Other containers on the docker network will <strong>need</strong> to address the controller. To do this, we will give this container
a network alias. At this time it would appear that this also forces you to add the container to a network which is not
the default network. This is a very useful feature which allows your containers to be isolated from one another and also
will allow you to have multiple networks running locally if you desire. To create a docker network issue:
<code>docker network create myFirstZitiNetwork</code>. </p>
<p>Later, when starting the controller, we&#39;ll supply this network as a parameter to the docker command as well as name the
network. That&#39;s done with these two options: <code>--network myFirstZitiNetwork --network-alias ziti-controller</code></p>
<h3 id="optional---expose-controller-port">Optional - Expose Controller Port</h3>
<p>Docker containers by default won&#39;t expose any ports that you could use from your local machine. If you want to be able
to use this controller from outside of docker you&#39;ll need to export the controller&#39;s API port. That&#39;s easy to do, simply
pass one more parameter to the docker command: <code>-p ${externalPort}:${internalPort}</code></p>
<h3 id="running-the-controller">Running the Controller</h3>
<p>Here&#39;s an example of how to make a folder for &quot;myFirstZitiNetwork&quot; in your home folder, and then launch a controller
using that folder. Do note that this command passes a couple extra flags you&#39;ll see used on this page. Notably
the <code>--rm</code> flag and the <code>-it</code> flag. The <code>--rm</code> flag instructs docker to delete the container when the container exits.
The <code>-it</code> flag will run the container interactively. Running interactively like this makes it easier to see the logs
produced, but you will need a terminal for each process you want to run. The choice is yours but in these examples we&#39;ll
use <code>-it</code> to make seeing the output from the logs easier.</p>
<p>Here&#39;s an example which will use the docker network named &quot;myFirstZitiNetwork&quot; and expose the controller to your local
computer on port 1280 (the default port).</p>
<pre><code class="lang-bash">mkdir -p ~/docker-volume/myFirstZitiNetwork
docker run \
  --network myFirstZitiNetwork \
  --network-alias ziti-controller \
  --network-alias ziti-edge-controller \
  -p 1280:1280 \
  -it \
  --rm \
  -v ~/docker-volume/myFirstZitiNetwork:/openziti/pki \
  openziti/quickstart \
  /openziti/scripts/run-controller.sh
</code></pre><h2 id="edge-router">Edge Router</h2>
<p>At this point you should have a <a href="../../manage/controller.html">Ziti Controller</a> running. You should have created your
docker network as well as creating the volume mount. Now it&#39;s time to connect your first edge router. The same docker
image that runs the controller can run an edge router. To start an edge router you will run a very similar command as
the one to start the controller with a couple of key differences.</p>
<pre><code class="lang-bash">docker run \
  -e ZITI_EDGE_ROUTER_RAWNAME=ziti-edge-router \
  --network myFirstZitiNetwork \
  --network-alias edge-controller-1 \
  -p 3022:3022 \
  -it \
  --rm \
  -v ~/docker-volume/myFirstZitiNetwork:/openziti/pki \
  openziti/quickstart \
  /openziti/scripts/run-edge-router.sh edge
</code></pre><h2 id="testing-the-network">Testing the Network</h2>
<p>With the controller and router running, you can now attach to the docker host running the Ziti controller and test that
the router did indeed come online and is running as you expect.  To do this we&#39;ll use another feature of the docker
command and <code>exec</code> into the machine. First you&#39;ll need to know your docker container name which you can figure out by
running <code>docker ps</code>.</p>
<pre><code class="lang-bash">$ docker ps

CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS          PORTS
                   NAMES
1b86c4b461e7   openziti/quickstart   &quot;/openziti/scripts/r…&quot;   10 minutes ago   Up 10 minutes   0.0.0.0:3022-&gt;3022/tcp, :::3022-&gt;3022/tcp   musing_engelbart
a33d58248d6e   openziti/quickstart   &quot;/openziti/scripts/r…&quot;   46 minutes ago   Up 46 minutes   0.0.0.0:1280-&gt;1280/tcp, :::1280-&gt;1280/tcp   xenodochial_cori
</code></pre><p>Above you&#39;ll see my controller is running in a container named &quot;xenodochial_cori&quot;. I can tell because it&#39;s using port</p>
<ol>
<li>Now I can <code>exec</code> into this container: <code>docker exec -it xenodochial_cori /bin/bash</code></li>
</ol>
<p>Once in the container, I can now issue <code>zitiLogin</code> to authenticate the <code>ziti</code> CLI.</p>
<pre><code class="lang-bash">zitiLogin
Token: b16f182f-88b3-4fcc-9bfc-1e32319ca486
Saving identity &#39;default&#39; to /openziti/ziti-cli.json
</code></pre><p>And finally, once authenticated I can test to see if the edge router is online in the controller and as you&#39;ll see, the
<code>isOnline</code> property is true!</p>
<pre><code class="lang-bash">ziti@a33d58248d6e:/openziti$ ziti edge list edge-routers
id: qNZyqZEix3    name: ziti-edge-router    isOnline: true    role attributes: {}
results: 1-1 of 1
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/openziti/ziti-doc/blob/master/docfx_project/ziti/quickstarts/network/local-with-docker.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span class='pull-left'><span><a href='https://netfoundry.io'>©2020 NetFoundry,Inc.</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/privacy-policy'>Privacy Policy</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/legal-items'>Legal</a></span>&nbsp;&nbsp;<span><a href='https://netfoundry.zendesk.com/hc/en-us'>Support</a></span>&nbsp;&nbsp;</span><span class='pull-right'><span><a href='https://www.facebook.com/NetFoundry/' target='_blank'><img height='25' src='/images/fb.svg'></a></span>&nbsp;<span><a href='https://twitter.com/netfoundry' target='_blank'><img height='25' src='/images/twit.svg'></a></span>&nbsp;<span><a href='https://www.linkedin.com/company/netfoundry/' target='_blank'><img height='25' src='/images/li.svg'></a></span>&nbsp;<span><a href='https://www.youtube.com/channel/UCGN6PFj1rZu50yme9YsICmg' target='_blank'><img height='25' src='/images/yt.svg'></a></span>&nbsp;&nbsp;&nbsp;</span><br>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>

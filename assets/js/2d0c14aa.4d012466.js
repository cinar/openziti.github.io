"use strict";(self.webpackChunkopen_ziti=self.webpackChunkopen_ziti||[]).push([[171],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},l=Object.keys(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),c=p(n),m=a,h=c["".concat(s,".").concat(m)]||c[m]||u[m]||l;return n?i.createElement(h,r(r({ref:t},d),{},{components:n})):i.createElement(h,r({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,r=new Array(l);r[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:a,r[1]=o;for(var p=2;p<l;p++)r[p]=n[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},64440:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var i=n(87462),a=(n(67294),n(3905));const l={sidebar_label:"Controller"},r="Controller Configuration Reference",o={unversionedId:"configuration/controller",id:"configuration/controller",title:"Controller Configuration Reference",description:"OpenZiti uses configuration files for controllers that are in the YAML format.",source:"@site/docs-ops/30-configuration/controller.md",sourceDirName:"30-configuration",slug:"/configuration/controller",permalink:"/operations/configuration/controller",draft:!1,tags:[],version:"current",frontMatter:{sidebar_label:"Controller"},sidebar:"rootSidebar",previous:{title:"Circuit Create Error Codes",permalink:"/operations/troubleshooting/circuit-create-error-codes"}},s={},p=[{value:"Conventions",id:"conventions",level:2},{value:"Addressing",id:"addressing",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Identity",id:"identity-sections",level:3},{value:"Sections",id:"sections",level:2},{value:"<code>ctrl</code>",id:"ctrl",level:3},{value:"<code>db</code>",id:"db",level:3},{value:"<code>edge</code>",id:"edge",level:3},{value:"<code>api</code>",id:"api",level:4},{value:"<code>enrollment</code>",id:"enrollment",level:4},{value:"<code>signingCert</code>",id:"signingcert",level:4},{value:"<code>edgeIdentity</code>",id:"edgeidentity",level:4},{value:"<code>edgeRouter</code>",id:"edgerouter",level:4},{value:"<code>events</code>",id:"events",level:3},{value:"<code>healthChecks</code>",id:"healthchecks",level:3},{value:"<code>identity</code>",id:"identity",level:3},{value:"<code>network</code>",id:"network",level:3},{value:"<code>profile</code>",id:"profile",level:3},{value:"<code>trace</code>",id:"trace",level:3},{value:"<code>web</code>",id:"web",level:3},{value:"<code>bindPoints</code>",id:"bindpoints",level:4},{value:"<code>apis</code>",id:"apis",level:4},{value:"<code>options</code>",id:"options",level:4},{value:"<code>v</code> (version)",id:"version",level:3}],d={toc:p};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"controller-configuration-reference"},"Controller Configuration Reference"),(0,a.kt)("p",null,"OpenZiti uses configuration files for controllers that are in the ",(0,a.kt)("a",{parentName:"p",href:"https://yaml.org/"},"YAML")," format."),(0,a.kt)("h2",{id:"conventions"},"Conventions"),(0,a.kt)("p",null,"The following conventions apply to multiple areas of the configuration file."),(0,a.kt)("h3",{id:"addressing"},"Addressing"),(0,a.kt)("p",null,"Listening and dialing addresses in OpenZiti are in the format of ",(0,a.kt)("inlineCode",{parentName:"p"},"<protocol>:<ip-or-host>:<port>")," format."),(0,a.kt)("p",null,"For servers that are listening ",(0,a.kt)("inlineCode",{parentName:"p"},"<ip-or-host>"),' should be the address of an interface to listen on or "0.0.0.0" for all\nIPv4 interfaces or "::" for all IPv6 interfaces. ',(0,a.kt)("inlineCode",{parentName:"p"},"<port>")," should be a valid port number that the server should listen\non."),(0,a.kt)("p",null,"For clients dialing a server the ",(0,a.kt)("inlineCode",{parentName:"p"},"<ip-or-host>")," should be an IP address or hostname that resolves to the target\nserver. ",(0,a.kt)("inlineCode",{parentName:"p"},"<port>")," should be the port the server is listening on."),(0,a.kt)("p",null,"For clients and server, the ",(0,a.kt)("inlineCode",{parentName:"p"},"<protocol>")," section is the protocol used to host or initiate the connection. It may be one\nof the following values, however ",(0,a.kt)("inlineCode",{parentName:"p"},"tls")," is suggested for most scenarios."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"tls")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"tcp")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"udp")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"dtls")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ws")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"wss")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"transwarp")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"transwarptls"))),(0,a.kt)("h3",{id:"environment-variables"},"Environment Variables"),(0,a.kt)("p",null,"All values in the configuration file support environment variable replacement. The environment variables are sourced\nfrom the scope of the executing process (i.e. controller, router). The syntax ",(0,a.kt)("inlineCode",{parentName:"p"},"${VARIABLE}")," is used."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"db: ${ZITI_DATA}/db/ctrl.db\n")),(0,a.kt)("h3",{id:"identity-sections"},"Identity"),(0,a.kt)("p",null,'OpenZiti uses a common framework for loading, storing, and processing certificate and private key configuration.\nIdentity sections all have a similar format. The use of the defined certificates is up to the implementing application.\nSo see their configuration sections for details on which values are utilized for what. This documentation provides an\noverview useful to understand the "default" assumptions. These sections can be formatted as YAML (as is the case for the\nrouter and controller configurations) or as JSON.'),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cert")," - (required) A string in the format of ",(0,a.kt)("inlineCode",{parentName:"li"},"<engine>:<value>")," that defines a x509 client certificate"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"key")," - (required) A string in the format of ",(0,a.kt)("inlineCode",{parentName:"li"},"<engine>:<value>")," that defines a private key used for ",(0,a.kt)("inlineCode",{parentName:"li"},"cert")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"server_cert"),"\nif ",(0,a.kt)("inlineCode",{parentName:"li"},"server_key")," is not defined"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"server_cert")," -(optional) A string in the format of ",(0,a.kt)("inlineCode",{parentName:"li"},"<engine>:<value>")," that defines a x509 certificate, if not defined ",(0,a.kt)("inlineCode",{parentName:"li"},"cert")," is used"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"server_key")," - (optional) A string in the format of ",(0,a.kt)("inlineCode",{parentName:"li"},"<engine>:<value>")," that defines a private key for ",(0,a.kt)("inlineCode",{parentName:"li"},"server_cert"),", if not\ndefined ",(0,a.kt)("inlineCode",{parentName:"li"},"key")," is used if ",(0,a.kt)("inlineCode",{parentName:"li"},"server_cert")," is defined"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ca")," - (optional) A string in the format of ",(0,a.kt)("inlineCode",{parentName:"li"},"<engine>:<value>")," that defines x509 certificate chain used to define trusted CAs"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"alt_server_certs")," - (optional) An array of objects with ",(0,a.kt)("inlineCode",{parentName:"li"},"server_cert")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"server_key")," values use to add additional server\ncertificates and keys not managed by OpenZiti (i.e. from public CAs like Let's Encrypt).")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"<engine>:<value>")," format is used to define multiple different source types. If the ",(0,a.kt)("inlineCode",{parentName:"p"},"<engine>:")," part is omitted, it\nis assumed to be ",(0,a.kt)("inlineCode",{parentName:"p"},"file:"),". The following engines are supported:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"file")," - indicates that ",(0,a.kt)("inlineCode",{parentName:"li"},"<value>")," is the path to a file"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"pem")," - indicates that ",(0,a.kt)("inlineCode",{parentName:"li"},"<value>")," is an inline PEM string")),(0,a.kt)("p",null,"Additional PKCS#11 engines such as ",(0,a.kt)("inlineCode",{parentName:"p"},"siometrics.so")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"authenta.so")," may be used if the library are present on the host\nmachine. This allows for access to hardware backed private keys."),(0,a.kt)("p",null,"Example Identity Section (Client & Server use same key):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'identity:\n  cert: "file:ctrl-client.cert.pem"\n  server_cert: "pem:-----BEGIN CERTIFICATE-----\\nMIIEtzCCAp+gAwIBAgICEA0wDQYJKoZIhvcNAQELBQAwgYsxCzAJBgNVBAYTAlVT..."\n  key: ctrl.key.pem\n  ca: ca-chain.cert.pem\n  alt_server_certs:\n    - server_cert: lets_encrypt.cert.pem\n    - server_key: lets_encrypt.key.pem\n')),(0,a.kt)("h2",{id:"sections"},"Sections"),(0,a.kt)("p",null,"The controller configuration file has several top level configuration sections that group together\nrelated configuration settings."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#ctrl"},(0,a.kt)("inlineCode",{parentName:"a"},"ctrl"))," - define control channel listener"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#db"},(0,a.kt)("inlineCode",{parentName:"a"},"db"))," - specifies database file location"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#edge"},(0,a.kt)("inlineCode",{parentName:"a"},"edge"))," - configures edge specific functionality"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#events"},(0,a.kt)("inlineCode",{parentName:"a"},"events"))," - allows configuration of event output"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#healthchecks"},(0,a.kt)("inlineCode",{parentName:"a"},"healthChecks"))," - enables controller database health checks for transactions"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#identity"},(0,a.kt)("inlineCode",{parentName:"a"},"identity"))," - configures the certificates used for outbound client connections, server listening, and CA\nbundles"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#network"},(0,a.kt)("inlineCode",{parentName:"a"},"network"))," - set network level cost values"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#profile"},(0,a.kt)("inlineCode",{parentName:"a"},"profile"))," - enables profiling of controller memory and CPU statistics"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#trace"},(0,a.kt)("inlineCode",{parentName:"a"},"trace"))," - adds a peek handler to all controller messaging for debug purposes"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#web"},(0,a.kt)("inlineCode",{parentName:"a"},"web"))," - configures API presentation exposure"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#version"},(0,a.kt)("inlineCode",{parentName:"a"},"v")," (version)")," - A special section to note the version of the configuration file, only ",(0,a.kt)("inlineCode",{parentName:"li"},"v: 3")," is currently supported")),(0,a.kt)("p",null,"The standard OpenZit experience minimally requires the following sections:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ctrl")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"db")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"identity")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"edge")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"web"))),(0,a.kt)("p",null,"Of those values, to start the controller only the ",(0,a.kt)("inlineCode",{parentName:"p"},"ctrl"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"db"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"identity")," sections are required. However, not\nincluding the ",(0,a.kt)("inlineCode",{parentName:"p"},"edge"),' section will start the controller in "fabric only" mode and will not support any edge functionality\nor concepts (identities, JWT enrollment, 3rd Party CAs, policies, etc.). Not including the ',(0,a.kt)("inlineCode",{parentName:"p"},"web")," section will result in\nnone of the REST APIs (Fabric Management API, Edge Client API, Edge Management API, Health Check API) being started.\nWithout the Edge and Fabric Management APIs running administration of the network will be impossible. Without the Edge\nClient API running it will be impossible for Edge clients to connect to services."),(0,a.kt)("p",null,"Example Minimum Controller Configuration:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"v: 3\n\ndb: ctrl.db\n\nidentity:\n  cert: ctrl-client.cert.pem\n  server_cert: ctrl-server.cert.pem\n  key: ctrl.key.pem\n  ca: ca-chain.cert.pem\n\nctrl:\n  listener: tls:127.0.0.1:6262\n\nedge:\n  enrollment:\n    signingCert:\n      cert: intermediate.cert.pem\n      key: intermediate.key.pem\n\n\nweb:\n  - name: all-apis-localhost\n    bindPoints:\n      - interface: 127.0.0.1:1280\n        address: 127.0.0.1:1280\n    apis:\n      - binding: fabric\n      - binding: edge-management\n      - binding: edge-client\n")),(0,a.kt)("h3",{id:"ctrl"},(0,a.kt)("inlineCode",{parentName:"h3"},"ctrl")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"ctrl")," section configures how the controller will listen for incoming connections from routers. This includes the\nprotocol(s) used for router connections and how those connections are managed."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"listener")," - (required) is in the format of ",(0,a.kt)("inlineCode",{parentName:"li"},"<protocol>:<interface>:<port>")," format. The value set here must be\nresolvable by routers and correspond the routers ",(0,a.kt)("inlineCode",{parentName:"li"},"ctrl.endpoint")," configuration value.\nSee ",(0,a.kt)("a",{parentName:"li",href:"#addressing"},"addressing"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"options")," - a set of optional connections options",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"maxQueuedConnects")," - (optional) the maximum number of connections to be accepted but awaiting initial messaging"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"maxOutstandingConnects")," - (optional) the maximum number of connection accepted and waiting for hello messaging to\ncomplete"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"connectTimeoutMs")," - (optional) the maximum number of milliseconds to wait for hello messaging to complete",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"writeTimeout")," - (optional)  the maximum amount of time to wait when writing data to a connection"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"newListener")," - (optional) an ",(0,a.kt)("inlineCode",{parentName:"li"},"<protocol>:<interface>:<port>")," address that is sent to routers to indicate a\ncontroller address migration. Should only be specified when the new listener address is reachable as clients will\nbegin to use the new value on restart")))),(0,a.kt)("p",null,"Example w/o Options:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"ctrl:\n  listener: tls:127.0.0.1:6262\n")),(0,a.kt)("p",null,"Example w/ Options:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"ctrl:\n  listener: tls:127.0.0.1:6262\n  options:\n    maxQueuedConnects: 1000\n    maxOutstandingConnects: 16\n    connectTimeoutMs:       1000\n    writeTimeout: 15s\n")),(0,a.kt)("h3",{id:"db"},(0,a.kt)("inlineCode",{parentName:"h3"},"db")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"db")," section is a single scalar value that defines the path to the database file that the controller should use.\nOpenZiti uses a file backed in memory database. This path may be on the same or different drive. This section is\nrequired."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"db: /mnt/fast-drive/db/ctrl.db\n")),(0,a.kt)("h3",{id:"edge"},(0,a.kt)("inlineCode",{parentName:"h3"},"edge")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"edge")," section instructs the controller to start the edge components. If the section is not defined, all edge\nfunctionality will be disabled. This includes all features associated with identities (e.g. identity enrollment), 3rd\nParty CAs, policies, edge router connections, posture checks, and more. It is highly unlikely that this section should\nbe omitted."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"edge")," section also has the following subsections:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"api")," - (required) defines API specific configuration"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"enrollment")," - (required) defines enrollment specific configuration")),(0,a.kt)("p",null,"Example Minimum Edge:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"edge:\n  enrollment:\n    signingCert:\n      cert: intermediate.cert.pem\n      key: intermediate.key.pem\n")),(0,a.kt)("p",null,"Example Fully Defined:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"edge:\n  api:\n    activityUpdateInterval: 90s\n    activityUpdateBatchSize: 250\n    sessionTimeout - optional, default 10m\n    sessionTimeout: 30m\n    address: 127.0.0.1:1280\n  enrollment:\n    signingCert:\n      cert: intermediate.cert.pem\n      key: intermediate.key.pem\n    edgeIdentity:\n      duration: 5m\n    edgeRouter:\n      duration: 5m\n")),(0,a.kt)("h4",{id:"api"},(0,a.kt)("inlineCode",{parentName:"h4"},"api")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"api")," section within the ",(0,a.kt)("inlineCode",{parentName:"p"},"edge")," section defines API specific functionality."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"activityUpdateInterval")," - (optional) the interval used to buffer API Session usage notices"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sessionTimeout")," - (optional) The amount of time an Edge API Session remains alive after the last REST API Request was\nprocessed\nor the last Edge Router connection for an API Session was closed"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"address")," - (required) the ",(0,a.kt)("inlineCode",{parentName:"li"},"<host>:<port>")," combination that should be used to externally resolve to the Edge Client\nAPI")),(0,a.kt)("p",null,"For ",(0,a.kt)("inlineCode",{parentName:"p"},"activityUpdateInterval"),", Edge Routers report connected API Sessions periodically and the controller tracks REST API\nrequests. ",(0,a.kt)("inlineCode",{parentName:"p"},"activityUpdateInterval")," defines the interval those updates are collated and buffered over. This is done to\nreduce the number of database writes required to persist API Session activity data. During the interval period the\ncontroller will buffer updates and flush at the end. Increasing this interval may increase the chance of unsaved updates\non controller crash or kill. Decreasing it will increase the frequency of database writes. The default should be\nsufficient."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"address")," setting is unique as it must match the ",(0,a.kt)("inlineCode",{parentName:"p"},"address")," in a ",(0,a.kt)("inlineCode",{parentName:"p"},"bindPoint")," for the ",(0,a.kt)("inlineCode",{parentName:"p"},"edge-client")," API. This is to\nensure that responses and data persisted outside the system can reach the controller. An example of this is\nenrollment JWTs that contain the URL that is used to complete enrollment via the Edge Client API."),(0,a.kt)("h4",{id:"enrollment"},(0,a.kt)("inlineCode",{parentName:"h4"},"enrollment")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"enrollment")," section under ",(0,a.kt)("inlineCode",{parentName:"p"},"edge")," defines values that pertain specifically to identity and router enrollment. This\nincludes the certificate and private key used to sign certificates as well as enrolment JWT lifetimes."),(0,a.kt)("p",null,"The enrolment section has these subsection:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"signingCert")," - (required)  defines the certificate and key used to sign identity and router certificates"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"edgeIdentity")," - (optional) controls identity enrollment options"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"edgeRouter")," - (optional) controls router enrollment options")),(0,a.kt)("h4",{id:"signingcert"},(0,a.kt)("inlineCode",{parentName:"h4"},"signingCert")),(0,a.kt)("p",null,"An object defining the ",(0,a.kt)("inlineCode",{parentName:"p"},"cert")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"key")," used to issue certificates to identities and routers."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cert")," - (required) the x509 PEM formatted certificate used to sign certificate, must be a root or intermediate CA"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"key")," - (required) the x509 PEM formatted private key used to sign certificates, must be the key for the certificate\ndefined\nin ",(0,a.kt)("inlineCode",{parentName:"li"},"cert"))),(0,a.kt)("p",null,"As this signing certificate will be the signer for all issued edge router certificates, it is important that all\nenrolling identities and routers trust the PKI that issued the signing certificate. To have that happen the trust anchor\nof the PKI the ",(0,a.kt)("inlineCode",{parentName:"p"},"signingCert")," is a member of should be in the ",(0,a.kt)("inlineCode",{parentName:"p"},"ca")," bundle defined in the controller's ",(0,a.kt)("inlineCode",{parentName:"p"},"identity")," section.\nThe ",(0,a.kt)("inlineCode",{parentName:"p"},"ca")," value is used as part of the trust bundle delivered to identities and routers during enrollment."),(0,a.kt)("h4",{id:"edgeidentity"},(0,a.kt)("inlineCode",{parentName:"h4"},"edgeIdentity")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"edgeIdentity")," section controls the lifetime of identity enrollment JWTs. It has only one value:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"duration")," - (optional) the lifetime of identity enrollment JWTs")),(0,a.kt)("h4",{id:"edgerouter"},(0,a.kt)("inlineCode",{parentName:"h4"},"edgeRouter")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"edgeRouter")," section controls the lifetime of router enrollment JWTs. It has only one value:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"duration")," - (optional) the lifetime of router enrollment JWTs")),(0,a.kt)("h3",{id:"events"},(0,a.kt)("inlineCode",{parentName:"h3"},"events")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"events")," section allows for the definition of multiple event loggers with their own handler and event subscriptions.\nHandlers define the type, format, and destination for events. Subscriptions handle which events are routed to the\nhandler. This allows different events to be output in different manners or to different locations."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"events")," section is an array of named objects. The name (",(0,a.kt)("inlineCode",{parentName:"p"},"jsonLogger")," in the example below) is used for\nconfiguration error output only. Each logger has a ",(0,a.kt)("inlineCode",{parentName:"p"},"subscriptions")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"handler")," section. The ",(0,a.kt)("inlineCode",{parentName:"p"},"subscriptions")," section is\nan array of objects with fields associated with the event type. Specifying an event type will cause it to be output via\nthe defined handler. If an event type is omitted, it will not be output. The list of valid event types and their options\nis as follows:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"edge.apiSessions")," - (optional) Edge API Session events",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"include"),' - (optional) a string or array of strings that specify which API session events to include ("created" and/or "\ndeleted")'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"edge.entityCounts")," - (optional) Edge entity counts (API Sessions, sessions, routers, etc.)",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"interval"),' - (optional) the time interval to generate entity count events on (e.g. "5s", "5000ms", "1h")'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"edge.sessions"),"  - (optional) Edge Session events",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"include"),' - (optional) a string or array of strings that specify which session events to include ("created" and/or "deleted")'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fabric.circuits"),"  - (optional) Fabric circuit events",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"include"),' - (optional) a string or array of strings that specify which circuit events to include ("created", "pathUpdated", "\ndeleted", "failed")'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fabric.links")," -  - (optional) Fabric link events"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fabric.routers")," - (optional) Fabric router events"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fabric.usage")," - (optional) Fabric usage events",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"version"),' - (optional) a string representing the value of the usage event to use ("2\' or "3")'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"metrics")," - (optional) - System-wide metrics",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"sourceFilter")," - (optional) a regular expression to match the source name value on"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"metricFilter")," - (optional) a regular expression to match the metric name value on"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"services")," - (optional) Service events")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"handler")," section contains two or three properties depending on ",(0,a.kt)("inlineCode",{parentName:"p"},"type"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"type"),' - (required) the type of handler ("file" or "stdout")'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"format")," - (required) the format of events for the ",(0,a.kt)("inlineCode",{parentName:"li"},"type"),' ("json" or "plain")'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"path"),' - (conditional) used the "file" ',(0,a.kt)("inlineCode",{parentName:"li"},"type"),", the path of the output file")),(0,a.kt)("p",null,"Example JSON File Logger:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"events:\n  jsonLogger:\n    subscriptions:\n      - type: fabric.circuits\n      - type: fabric.links\n      - type: fabric.routers\n      - type: fabric.terminators\n      - type: metrics\n        sourceFilter: .*\n        metricFilter: .*\n      - type: edge.sessions\n      - type: edge.apiSessions\n      - type: fabric.usage\n      - type: services\n      - type: edge.entityCounts\n        interval: 5s\n    handler:\n      type: file\n      format: json\n      path: /tmp/ziti-events.log\n")),(0,a.kt)("h3",{id:"healthchecks"},(0,a.kt)("inlineCode",{parentName:"h3"},"healthChecks")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"healthChecks")," section configures how often health checking is performed. As of now, health checks are limited\nto ensuring the internal database has not deadlocked by attempting to aquire a locking transaction on some interval."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"boltCheck")," - (optional) bbolt specific configuration",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"interval")," - (optional) how often to try entering a bolt read transaction, defaults to 30 seconds"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"timeout")," - (optional) how long to wait for a transaction before timing out, defaults to 15 seconds"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"initialDelay")," - (optional) how long to wait on startup before performing the first check, defaults to 15 secconds")))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"healthChecks:\n  boltCheck:\n    # How often to try entering a bolt read tx. Defaults to 30 seconds\n    interval: 30s\n    # When to timeout the check. Defaults to 15 seconds\n    timeout: 15s\n    # How long to wait before starting the check. Defaults to 15 seconds\n    initialDelay: 15s\n")),(0,a.kt)("h3",{id:"identity"},(0,a.kt)("inlineCode",{parentName:"h3"},"identity")),(0,a.kt)("p",null,"The identity section includes the default server certificate and private key used for services hosted by the controller,\nalternate server certificates and keys to support SNI on hosted services, client certificate and private key when making\nconnections, and the ",(0,a.kt)("inlineCode",{parentName:"p"},"ca")," bundle that the controller will use when making connections and when bootstrapping identities\nand routers. See the general ",(0,a.kt)("a",{parentName:"p",href:"#identity-sections"},"identity")," over above."),(0,a.kt)("h3",{id:"network"},(0,a.kt)("inlineCode",{parentName:"h3"},"network")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"network")," section sets network wide options."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"minRouterCost")," - (optional) the minimum router cost (default 10)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"routerConnectionChurnLimit")," -  (optional) how often a new connection from a router can take over for an existing\nconnection (\ndefault 1m)")),(0,a.kt)("h3",{id:"profile"},(0,a.kt)("inlineCode",{parentName:"h3"},"profile")),(0,a.kt)("p",null,"The profile section allows for ",(0,a.kt)("a",{parentName:"p",href:"https://go.dev/blog/pprof"},"CPU (pprof) and memory (memprof)")," dumps to be created. CPU\nprofiling is buffered by the application's runtime and output to the designated file. Memory profiling allows the\ninterval memory profiling occurs at and is output. These settings are useful for debugging purposes only and should not\nbe enabled in production environments without careful consideration."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cpu")," - (optional)",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"path")," - (required) the path to output the pprof data"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"memory")," - (optional)",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"path")," - (required) the path to output the memprof data"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"intervalMs")," (optional) the frequency to output memprof data (default 15s)")))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"profile:\n   cpu:\n       path: /home/plorenz/tmp/ctrl.cpu.pprof\n  memory:\n    path: ctrl.memprof\n    intervalMs: 150000\n")),(0,a.kt)("h3",{id:"trace"},(0,a.kt)("inlineCode",{parentName:"h3"},"trace")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"trace")," section instructs the controller to output incoming and outgoing messaging it receives. This setting is\nuseful for debugging purposes only and should not be enabled in production environments without careful consideration."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"path")," - (required) the file to output decoded messages to")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"trace:\n  path: /var/opt/open.ziti.ctrl.trace\n")),(0,a.kt)("h3",{id:"web"},(0,a.kt)("inlineCode",{parentName:"h3"},"web")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"web")," section is powered by ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/openziti/xweb"},"XWeb"),". XWeb allows web APIs to be defined in code and\nexposed on multiple interfaces/networks through configuration alone."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"web:\n  - name: all-apis-localhost\n    bindPoints:\n      - interface: 127.0.0.1:1280\n        address: 127.0.0.1:1280\n        newAddress: localhost:1280\n        identity:\n          cert:                 ctrl-client.cert.pem\n          server_cert:          ctrl-server.cert.pem\n          key:                  ctrl.key.pem\n          ca:                   ca-chain.cert.pem\n    options:\n      idleTimeout: 5000ms\n      readTimeout: 5000ms\n      writeTimeout: 100000ms\n      minTLSVersion: TLS1.2\n      maxTLSVersion: TLS1.3\n    apis:\n      - binding: health-checks\n      - binding: fabric\n      - binding: edge-management\n      - binding: edge-client\n")),(0,a.kt)("p",null,"The structure of the ",(0,a.kt)("inlineCode",{parentName:"p"},"web")," section is an array of API exposure options:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"web:\n  - name: API Exposure 1\n    ...\n  - name: API Exposure 2\n    ...\n")),(0,a.kt)("p",null,"Each exposure has the following configuration options:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name")," - (required) a name used for logging and error messaging"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"bindPoints")," - (required) the interfaces, external addresses, and migration address options for this exposure"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"apis")," - (required) a list of APIs and their options from the list above"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"options")," - (optional) a set of options used to tune HTTP/TLS")),(0,a.kt)("h4",{id:"bindpoints"},(0,a.kt)("inlineCode",{parentName:"h4"},"bindPoints")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"bindPoints")," are used to instruct XWeb on where to listen for new connections. Each exposure can have multiple bind\npints to have the same API listen on one or more interfaces/networks. Additionally, each interface listened on can have\nits own external address and migration address."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"interface"),' - (required) the interface and port to listen on ("0.0.0.0" for all IPv4 interfaces, "::" for all IPv6\ninterfaces)'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"address")," - (required) the host:port combination that external devices can use to reach the exposed interface (ip or\nhost name)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"newAddress")," - (optional) when specified, ",(0,a.kt)("inlineCode",{parentName:"li"},"newAddress")," will be sent to clients in the HTTP header ",(0,a.kt)("inlineCode",{parentName:"li"},"ziti-ctrl-address"))),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"newAddress")," should only be specified when clients can use the new host:port combination to reach the specified APIs.\nThis setting is used to migrate APIs between ip/hostnames."),(0,a.kt)("h4",{id:"apis"},(0,a.kt)("inlineCode",{parentName:"h4"},"apis")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"apis")," section defines which APIs will be hosted on this exposure. The controller has the following APIs defined:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"health-checks")," - provides a health check API that allows remote parties to verify the health of the controller"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fabric")," - the Fabric Management API which allows remote administration of a network"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"edge-management")," - the Edge Management API which allows remote administration of a network's edge components (\nidentities, policies, authentication, etc.)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"edge-clietn")," - the Edge Client API which allows clients to authenticate and request connections to services")),(0,a.kt)("p",null,"Each API may have their own options, but currently do not."),(0,a.kt)("h4",{id:"options"},(0,a.kt)("inlineCode",{parentName:"h4"},"options")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"idleTimeout")," - (optional) the maximum amount of time to wait for the next request when keep-alives are enabled, if\nIdleTimeout is zero, the value of ReadTimeout is used"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"readTimeout")," - (optional) the maximum duration for reading the entire request, including the body"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"writeTimeout"),"  - (optional) the maximum duration before timing out writes of the response, it is reset whenever a new\nrequest\u2019s\nheader is read"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"minTLSVersion")," - (optional) the minimum TLS version to support (TLS1.1, TLS1.2, TLS1.3)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"maxTLSVersion")," - (optional) the maximum TLS version to support (TLS1.1, TLS1.2, TLS1.3)")),(0,a.kt)("h3",{id:"version"},(0,a.kt)("inlineCode",{parentName:"h3"},"v")," (version)"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"v"),' section is used to detect if the version file is supported by the OpenZiti binary read it. The current and only\nsupported value is "3".'))}c.isMDXComponent=!0}}]);
"use strict";(self.webpackChunkopen_ziti=self.webpackChunkopen_ziti||[]).push([[5347],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=c(n),h=r,g=d["".concat(s,".").concat(h)]||d[h]||u[h]||a;return n?i.createElement(g,l(l({ref:t},p),{},{components:n})):i.createElement(g,l({ref:t},p))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<a;c++)l[c]=n[c];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},25213:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var i=n(87462),r=(n(67294),n(3905));const a={sidebar_position:50,sidebar_label:"Services",title:"Services"},l="3.0 Ziti services",o={unversionedId:"guides/Digital_Ocean/Services",id:"guides/Digital_Ocean/Services",title:"Services",description:"3.1 Introduction",source:"@site/docs/guides/Digital_Ocean/Services.md",sourceDirName:"guides/Digital_Ocean",slug:"/guides/Digital_Ocean/Services",permalink:"/docs/guides/Digital_Ocean/Services",draft:!1,editUrl:"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/Digital_Ocean/Services.md",tags:[],version:"current",sidebarPosition:50,frontMatter:{sidebar_position:50,sidebar_label:"Services",title:"Services"},sidebar:"docsSidebar",previous:{title:"Router",permalink:"/docs/guides/Digital_Ocean/Router"},next:{title:"Local Gateway",permalink:"/docs/category/local-gateway"}},s={},c=[{value:"3.1 Introduction",id:"31-introduction",level:2},{value:"3.2 Setup VMs for ziti network",id:"32-setup-vms-for-ziti-network",level:2},{value:"3.2.1 Controller",id:"321-controller",level:3},{value:"3.2.1.1 ZAC",id:"3211-zac",level:4},{value:"3.2.1.2 CLI",id:"3212-cli",level:4},{value:"3.2.2 Router",id:"322-router",level:3},{value:"3.2.2.1 ZAC",id:"3221-zac",level:4},{value:"3.2.2.2 CLI",id:"3222-cli",level:4},{value:"3.2.3 Tunnelers/Identities",id:"323-tunnelersidentities",level:3},{value:"3.2.3.1 Create Identity with ZAC",id:"3231-create-identity-with-zac",level:4},{value:"3.2.3.2 Create Identity with CLI",id:"3232-create-identity-with-cli",level:4},{value:"3.2.3.3 Register Identities",id:"3233-register-identities",level:4},{value:"3.2.3.4 Gather info of the VMs",id:"3234-gather-info-of-the-vms",level:4},{value:"3.3 Create Edge Router Policy",id:"33-create-edge-router-policy",level:2},{value:"3.3.1 ZAC",id:"331-zac",level:3},{value:"3.3.2 CLI",id:"332-cli",level:3},{value:"3.4 Setup Tunnel to Tunnel ssh connection",id:"34-setup-tunnel-to-tunnel-ssh-connection",level:2},{value:"3.4.1 Create a host.v1 config",id:"341-create-a-hostv1-config",level:3},{value:"3.4.1.1 ZAC",id:"3411-zac",level:4},{value:"3.4.1.2 CLI",id:"3412-cli",level:4},{value:"3.4.2 Create an intercept.v1 config",id:"342-create-an-interceptv1-config",level:3},{value:"3.4.2.1 ZAC",id:"3421-zac",level:4},{value:"3.4.2.2 CLI",id:"3422-cli",level:4},{value:"3.4.3 Create Service",id:"343-create-service",level:3},{value:"3.4.3.1 ZAC",id:"3431-zac",level:4},{value:"3.4.3.2 CLI",id:"3432-cli",level:4},{value:"3.4.4 Create Bind Service policy",id:"344-create-bind-service-policy",level:3},{value:"3.4.4.1 ZAC",id:"3441-zac",level:4},{value:"3.4.4.2 CLI",id:"3442-cli",level:4},{value:"3.4.5 Create Dial Service policy",id:"345-create-dial-service-policy",level:3},{value:"3.4.5.1 ZAC",id:"3451-zac",level:4},{value:"3.4.5.2 CLI",id:"3452-cli",level:4},{value:"3.4.6 Verify the connection",id:"346-verify-the-connection",level:3},{value:"3.5 Setup Tunnel to ERT http connection",id:"35-setup-tunnel-to-ert-http-connection",level:2},{value:"3.5.1 Create a host.v1 config",id:"351-create-a-hostv1-config",level:3},{value:"3.5.1.1 ZAC",id:"3511-zac",level:4},{value:"3.5.1.2 CLI",id:"3512-cli",level:4},{value:"3.5.2 Create an intercept.v1 config",id:"352-create-an-interceptv1-config",level:3},{value:"3.5.2.1 ZAC",id:"3521-zac",level:4},{value:"3.5.2.2 CLI",id:"3522-cli",level:4},{value:"3.5.3 Create Service",id:"353-create-service",level:3},{value:"3.5.3.1 ZAC",id:"3531-zac",level:4},{value:"3.5.3.2 CLI",id:"3532-cli",level:4},{value:"3.5.4 Create Bind Service policy",id:"354-create-bind-service-policy",level:3},{value:"3.5.4.1 ZAC",id:"3541-zac",level:4},{value:"3.5.4.2 CLI",id:"3542-cli",level:4},{value:"3.5.5 Create Dial Service policy",id:"355-create-dial-service-policy",level:3},{value:"3.5.5.1 ZAC",id:"3551-zac",level:4},{value:"3.5.5.2 CLI",id:"3552-cli",level:4},{value:"3.5.6 Verify the connection",id:"356-verify-the-connection",level:3},{value:"3.5.7 Conclusion",id:"357-conclusion",level:3},{value:"3.6 Setup Connection from a non-OpenZiti client",id:"36-setup-connection-from-a-non-openziti-client",level:2},{value:"3.6.1 Introduction",id:"361-introduction",level:3},{value:"3.6.2 Create a host.v1 config",id:"362-create-a-hostv1-config",level:3},{value:"3.6.2.1 ZAC",id:"3621-zac",level:4},{value:"3.6.2.2 CLI",id:"3622-cli",level:4},{value:"3.6.3 Create an intercept.v1 config",id:"363-create-an-interceptv1-config",level:3},{value:"3.6.3.1 ZAC",id:"3631-zac",level:4},{value:"3.6.3.2 CLI",id:"3632-cli",level:4},{value:"3.6.4 Create Service",id:"364-create-service",level:3},{value:"3.6.4.1 ZAC",id:"3641-zac",level:4},{value:"3.6.4.2 CLI",id:"3642-cli",level:4},{value:"3.6.5 Create Bind Service policy",id:"365-create-bind-service-policy",level:3},{value:"3.6.5.1 ZAC",id:"3651-zac",level:4},{value:"3.6.5.2 CLI",id:"3652-cli",level:4},{value:"3.6.6 Create Dial Service policy",id:"366-create-dial-service-policy",level:3},{value:"3.6.6.1 ZAC",id:"3661-zac",level:4},{value:"3.6.6.2 CLI",id:"3662-cli",level:4},{value:"3.6.7 Verify the connection",id:"367-verify-the-connection",level:3}],p={toc:c};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,i.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"30-ziti-services"},"3.0 Ziti services"),(0,r.kt)("h2",{id:"31-introduction"},"3.1 Introduction"),(0,r.kt)("p",null,"In this guide, we will demonstrate ziti services with three examples:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"connection between two identities running ziti-edge-tunnel"),(0,r.kt)("li",{parentName:"ul"},"connection between ziti-edge-tunnel and a ziti-router (with tunnel enabled)"),(0,r.kt)("li",{parentName:"ul"},"connection from a non-OpenZiti endpoint using router as GW")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(35799).Z,width:"593",height:"215"})),(0,r.kt)("p",null,"This guide provides both CLI and GUI (ZAC) instructions. To use ZAC, make sure ZAC is installed. If you have not installed ZAC, and would like to use it in this section, please follow the ",(0,r.kt)("a",{parentName:"p",href:"/docs/learn/quickstarts/zac/"},"ZAC Setup Guide")," before continue."),(0,r.kt)("h2",{id:"32-setup-vms-for-ziti-network"},"3.2 Setup VMs for ziti network"),(0,r.kt)("h3",{id:"321-controller"},"3.2.1 Controller"),(0,r.kt)("h4",{id:"3211-zac"},"3.2.1.1 ZAC"),(0,r.kt)("p",null,"Please make sure you can login to your network and see the welcome screen before continue."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(17228).Z,width:"1695",height:"958"})),(0,r.kt)("h4",{id:"3212-cli"},"3.2.1.2 CLI"),(0,r.kt)("p",null,"You will need to login to controller to provision identities and service. Please make sure you are performing the action on the right node."),(0,r.kt)("p",null,"On the controller, before performing the CLI command, you will need to login first:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"zitiLogin\n")),(0,r.kt)("p",null,"The login token expires after a period of time. If the token expired, you will need to login again via the same command. You will see error message like this when the CLI logs out:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'error: error listing https://161.35.108.218:8441/edge/management/v1/config-types?filter=id%3D%22host.v1%22 in Ziti Edge Controller. Status code: 401 Unauthorized, Server returned: {\n    "error": {\n        "code": "UNAUTHORIZED",\n        "message": "The request could not be completed. The session is not authorized or the credentials are invalid",\n        "requestId": "7zxWCy7Vx"\n    },\n    "meta": {\n        "apiEnrollmentVersion": "0.0.1",\n        "apiVersion": "0.0.1"\n    }\n}\n')),(0,r.kt)("h3",{id:"322-router"},"3.2.2 Router"),(0,r.kt)("p",null,"Follow the ",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/Digital_Ocean/Router/"},"Router guide"),' to setup a "Router with link listener and tunneler". We will name this router: ',(0,r.kt)("strong",{parentName:"p"},"JAMES-ER-SF")),(0,r.kt)("h4",{id:"3221-zac"},"3.2.2.1 ZAC"),(0,r.kt)("p",null,"On the ZAC ",(0,r.kt)("strong",{parentName:"p"},"ROUTERS")," screen, you can check your router and make sure it is created correctly. You can also check the identity associated with the router by clicked on ",(0,r.kt)("strong",{parentName:"p"},"IDENTITIES")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(72322).Z,width:"1656",height:"656"})),(0,r.kt)("p",null,"On the ",(0,r.kt)("strong",{parentName:"p"},"IDENTITIES")," screen, you will see an identity match your router name."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(14345).Z,width:"1641",height:"645"})),(0,r.kt)("h4",{id:"3222-cli"},"3.2.2.2 CLI"),(0,r.kt)("p",null,"Once the router is create, you can check the ",(0,r.kt)("strong",{parentName:"p"},"controller")," to make sure the router is created correctly."),(0,r.kt)("p",null,"You should see an router named ",(0,r.kt)("strong",{parentName:"p"},"JAMES-ER-SF")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list edge-routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                 \u2502 ONLINE \u2502 ALLOW TRANSIT \u2502 COST \u2502 ATTRIBUTES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 2hWwOcTaR  \u2502 James-NC-edge-router \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2502 xTP5-y7VxP \u2502 JAMES-ER-SF          \u2502 false  \u2502 true          \u2502    0 \u2502            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,r.kt)("p",null,"You should also see an identity named ",(0,r.kt)("strong",{parentName:"p"},"JAMES-ER-SF")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list identities\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                 \u2502 TYPE   \u2502 ATTRIBUTES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 2hWwOcTaR  \u2502 James-NC-edge-router \u2502 Router \u2502            \u2502\n\u2502 bhNbEYGrM  \u2502 Default Admin        \u2502 User   \u2502            \u2502\n\u2502 xTP5-y7VxP \u2502 JAMES-ER-SF          \u2502 Router \u2502            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-3 of 3\n")),(0,r.kt)("p",null,"Since we created this router as link listener, you should also check the link listener function is correctly setup. Check the router on fabric to make sure it has listeners displayed for the router you created."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti fabric list routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                 \u2502 ONLINE \u2502 COST \u2502 NO TRAVERSAL \u2502 DISABLED \u2502 VERSION                \u2502 LISTENERS                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 2hWwOcTaR  \u2502 James-NC-edge-router \u2502 true   \u2502    0 \u2502 false        \u2502 false    \u2502 v0.27.7 on linux/amd64 \u2502 1: tls:161.35.108.218:10080 \u2502\n\u2502 xTP5-y7VxP \u2502 JAMES-ER-SF          \u2502 true   \u2502    0 \u2502 false        \u2502 false    \u2502 v0.27.7 on linux/amd64 \u2502 1: tls:146.190.120.86:80    \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,r.kt)("h3",{id:"323-tunnelersidentities"},"3.2.3 Tunnelers/Identities"),(0,r.kt)("p",null,"We need two tunnelers for our testing. Please follow ",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/Digital_Ocean/Controller/"},"controller guide"),' section of "Create VM on Digital Ocean" to create two VMs running Ubuntu 22.04.'),(0,r.kt)("h4",{id:"3231-create-identity-with-zac"},"3.2.3.1 Create Identity with ZAC"),(0,r.kt)("p",null,"To create Identities on ZAC, go to the Identities screen, and press ",(0,r.kt)("strong",{parentName:"p"},"+")," icon. On the ",(0,r.kt)("strong",{parentName:"p"},"CREATE IDENTITY")," widget, enter the ",(0,r.kt)("strong",{parentName:"p"},"NAME")," of the identity (Required and has to be unique). Leave the ",(0,r.kt)("strong",{parentName:"p"},"IDENTITY TYPE"),' as "Device". Leave the ',(0,r.kt)("strong",{parentName:"p"},"ENROLLMENT TYPE"),' as "One Time Token". Fill in other optional fields and press ',(0,r.kt)("strong",{parentName:"p"},"SAVE"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(14977).Z,width:"1031",height:"998"})),(0,r.kt)("p",null,"Once the identity is created, you can check your identity and download the ",(0,r.kt)("strong",{parentName:"p"},"JWT")," from the ",(0,r.kt)("strong",{parentName:"p"},"MANAGE IDENTITIES")," screen"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(87084).Z,width:"1364",height:"621"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Create two identities before you continue.")),(0,r.kt)("h4",{id:"3232-create-identity-with-cli"},"3.2.3.2 Create Identity with CLI"),(0,r.kt)("p",null,"Create two identities (JAMES-CL-NY, JAMES-CL-SF) on the ",(0,r.kt)("strong",{parentName:"p"},"controller"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create identity user JAMES-CL-NY -o JAMES-CL-NY.jwt\nziti edge create identity user JAMES-CL-SF -o JAMES-CL-SF.jwt\n")),(0,r.kt)("h4",{id:"3233-register-identities"},"3.2.3.3 Register Identities"),(0,r.kt)("p",null,"Login to your VMs created earlier, follow ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/tunnelers/linux/"},"Install Linux Package")," ",(0,r.kt)("strong",{parentName:"p"},"Ubuntu Jammy 22.04")," section to install and register your ziti-edge-tunnel."),(0,r.kt)("p",null,"After the tunnel is registered, check the status and make sure it is running"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# systemctl status ziti-edge-tunnel\n\u25cf ziti-edge-tunnel.service - Ziti Edge Tunnel\n     Loaded: loaded (/etc/systemd/system/ziti-edge-tunnel.service; enabled; vendor preset: enabled)\n     Active: active (running) since Wed 2023-04-05 20:57:04 UTC; 1min 41s ago\n    Process: 2640 ExecStartPre=/opt/openziti/bin/ziti-edge-tunnel.sh (code=exited, status=0/SUCCESS)\n   Main PID: 2641 (ziti-edge-tunne)\n      Tasks: 5 (limit: 2323)\n     Memory: 6.5M\n        CPU: 752ms\n     CGroup: /system.slice/ziti-edge-tunnel.service\n             \u2514\u25002641 /opt/openziti/bin/ziti-edge-tunnel run --verbose=2 --dns-ip-range=100.64.0.1/10 --identity-dir=/opt/openziti/etc/identities\n")),(0,r.kt)("h4",{id:"3234-gather-info-of-the-vms"},"3.2.3.4 Gather info of the VMs"),(0,r.kt)("p",null,"After you registered both tunnelers, write down the local IP and subnet of these VMs, we will be using the local IP to test our traffics."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"JAMES-ER-SF: 10.124.0.2/20\nJAMES-CL-SF: 10.124.0.3/20\nJAMES-CL-NY: 10.136.219.136/16\n")),(0,r.kt)("h2",{id:"33-create-edge-router-policy"},"3.3 Create Edge Router Policy"),(0,r.kt)("p",null,"By default, the system created an edge router policy to bind all identities to any routers tag with ",(0,r.kt)("strong",{parentName:"p"},"#public")," attribute. So, we need to add #public to our router (JAMES-ER-SF). "),(0,r.kt)("h3",{id:"331-zac"},"3.3.1 ZAC"),(0,r.kt)("p",null,"From the ",(0,r.kt)("strong",{parentName:"p"},"ROUTERS")," screen, you can choose ",(0,r.kt)("strong",{parentName:"p"},"Router Policies")," to display the edge router policies. As you can see, the default policy is already in place."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(70114).Z,width:"1670",height:"593"})),(0,r.kt)("p",null,'To add attribute "public" to the router, choose your router from the ',(0,r.kt)("strong",{parentName:"p"},"ROUTERS")," screen, click on ",(0,r.kt)("strong",{parentName:"p"},"...")," and choose ",(0,r.kt)("strong",{parentName:"p"},"Edit")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(28506).Z,width:"1362",height:"553"})),(0,r.kt)("p",null,"On the ",(0,r.kt)("strong",{parentName:"p"},"EDIT EDGE ROUTER")," screen, you can add ",(0,r.kt)("strong",{parentName:"p"},"public")," attribute and then press ",(0,r.kt)("strong",{parentName:"p"},"SAVE")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(94306).Z,width:"622",height:"757"})),(0,r.kt)("h3",{id:"332-cli"},"3.3.2 CLI"),(0,r.kt)("p",null,"On the ",(0,r.kt)("strong",{parentName:"p"},"controller"),":"),(0,r.kt)("p",null,"check the edge router policy"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list edge-router-policies\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME                          \u2502 EDGE ROUTER ROLES     \u2502 IDENTITY ROLES        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 2my8BX4UTsdnNtH5jInLH2 \u2502 allEdgeRouters                \u2502 #public               \u2502 #all                  \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n")),(0,r.kt)("p",null,"check the edge router attribute"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list edge-routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                 \u2502 ONLINE \u2502 ALLOW TRANSIT \u2502 COST \u2502 ATTRIBUTES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 2hWwOcTaR  \u2502 James-NC-edge-router \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2502 xTP5-y7VxP \u2502 JAMES-ER-SF          \u2502 true   \u2502 true          \u2502    0 \u2502            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n")),(0,r.kt)("p",null,'Add "public" attribute to our router:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'# ziti edge update edge-router JAMES-ER-SF -a "public"\n# ziti edge list edge-routers\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID         \u2502 NAME                 \u2502 ONLINE \u2502 ALLOW TRANSIT \u2502 COST \u2502 ATTRIBUTES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 2hWwOcTaR  \u2502 James-NC-edge-router \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2502 xTP5-y7VxP \u2502 JAMES-ER-SF          \u2502 true   \u2502 true          \u2502    0 \u2502 public     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n')),(0,r.kt)("h2",{id:"34-setup-tunnel-to-tunnel-ssh-connection"},"3.4 Setup Tunnel to Tunnel ssh connection"),(0,r.kt)("p",null,"In this section, we will be showing how to configure ziti to establish ssh service via our network. We will be using a pseudo dns name (t2tssh.ziti) to establish this connection.  The intercept side (ingress) will be JAMES-CL-SF, the server side (egress) will be JAMES-CL-NY."),(0,r.kt)("p",null,"For CLI procedures, all commands are done on the ",(0,r.kt)("strong",{parentName:"p"},"controller")),(0,r.kt)("h3",{id:"341-create-a-hostv1-config"},"3.4.1 Create a host.v1 config"),(0,r.kt)("p",null,'This config is used instruct the server-side tunneler how to offload the traffic from the overlay, back to the underlay. We are dropping the traffic off our loopback interface, so we use the address "127.0.0.1\u201c'),(0,r.kt)("h4",{id:"3411-zac"},"3.4.1.1 ZAC"),(0,r.kt)("p",null,"Create the configuration from ",(0,r.kt)("strong",{parentName:"p"},"MANAGE CONFIGURATIONS")," screen."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(12173).Z,width:"670",height:"1175"})),(0,r.kt)("h4",{id:"3412-cli"},"3.4.1.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create config t2thostconf host.v1 \'{"protocol":"tcp", "address":"127.0.0.1", "port":22}\'\n')),(0,r.kt)("h3",{id:"342-create-an-interceptv1-config"},"3.4.2 Create an intercept.v1 config"),(0,r.kt)("p",null,'This config is used to instruct the intercept-side tunneler how to correctly intercept the targeted traffic and put it onto the overlay. We are setting up intercept on dns name "t2tssh.ziti"'),(0,r.kt)("h4",{id:"3421-zac"},"3.4.2.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(54782).Z,width:"630",height:"979"})),(0,r.kt)("p",null,"Check the provisioned configs on the configuration screen:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(50159).Z,width:"1350",height:"290"})),(0,r.kt)("h4",{id:"3422-cli"},"3.4.2.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create config t2tintconf intercept.v1 \'{"protocols": ["tcp"], "addresses": ["t2tssh.ziti"], "portRanges": [{"low": 22, "high": 22}]}\'\n')),(0,r.kt)("p",null,"If the command finished successfully, you will see two configs:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list configs\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME        \u2502 CONFIG TYPE  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1R9iDpU7OvREH6LNxQapPO \u2502 t2tintconf  \u2502 intercept.v1 \u2502\n\u2502 gIeZ1KgilGXzkY4RxDF2f  \u2502 t2thostconf \u2502 host.v1      \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,r.kt)("h3",{id:"343-create-service"},"3.4.3 Create Service"),(0,r.kt)("p",null,'Now we need to put these two configs into a service. We going to name the service "t2tssh":'),(0,r.kt)("h4",{id:"3431-zac"},"3.4.3.1 ZAC"),(0,r.kt)("p",null,"Create service from ",(0,r.kt)("strong",{parentName:"p"},"Services")," menu from ",(0,r.kt)("strong",{parentName:"p"},"MANAGE EDGE SERVICES")," screen."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(79723).Z,width:"1021",height:"773"})),(0,r.kt)("h4",{id:"3432-cli"},"3.4.3.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service t2tssh -c t2tintconf,t2thostconf\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check Service")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list services\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                    \u2502 NAME   \u2502 ENCRYPTION \u2502 TERMINATOR STRATEGY \u2502 ATTRIBUTES \u2502\n\u2502                       \u2502        \u2502  REQUIRED  \u2502                     \u2502            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 CZJi5tDxTk8C8XymCbu7f \u2502 t2tssh \u2502 true       \u2502 smartrouting        \u2502            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-1 of 1\n")),(0,r.kt)("p",null,"Please note, the ",(0,r.kt)("strong",{parentName:"p"},"Encryption = true")," and ",(0,r.kt)("strong",{parentName:"p"},"smartrouting")," are default setting."),(0,r.kt)("h3",{id:"344-create-bind-service-policy"},"3.4.4 Create Bind Service policy"),(0,r.kt)("p",null,"Now we need to specify which tunneler (in our case, ",(0,r.kt)("strong",{parentName:"p"},"JAMES-CL-NY"),")is going to host the service by setting up a bind service policy"),(0,r.kt)("h4",{id:"3441-zac"},"3.4.4.1 ZAC"),(0,r.kt)("p",null,"Create a ",(0,r.kt)("strong",{parentName:"p"},"service policy")," from ",(0,r.kt)("strong",{parentName:"p"},"MANAGE SERVICE POLICIES")," screen:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(83429).Z,width:"649",height:"851"})),(0,r.kt)("h4",{id:"3442-cli"},"3.4.4.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy t2tssh.bind Bind --service-roles '@t2tssh' --identity-roles \"@JAMES-CL-NY\"\n")),(0,r.kt)("h3",{id:"345-create-dial-service-policy"},"3.4.5 Create Dial Service policy"),(0,r.kt)("p",null,"Now we need to specify the intercept side tunneler (",(0,r.kt)("strong",{parentName:"p"},"JAMES-CL-SF"),") for the service by setting up a dial service policy"),(0,r.kt)("h4",{id:"3451-zac"},"3.4.5.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(73005).Z,width:"617",height:"846"})),(0,r.kt)("p",null,"We should have two service policies created. The services name should match on two policies.  One policy is Bind and the other ons is Dial.  They should be set to different identities."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(41838).Z,width:"1349",height:"293"})),(0,r.kt)("h4",{id:"3452-cli"},"3.4.5.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy t2tssh.dial Dial --service-roles '@t2tssh' --identity-roles \"@JAMES-CL-SF\"\n")),(0,r.kt)("p",null,"Make sure both policies are setup correctly\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list service-policies\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME        \u2502 SEMANTIC \u2502 SERVICE ROLES \u2502 IDENTITY ROLES \u2502 POSTURE CHECK ROLES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 3h25stJwThctE1AAJRGVwP \u2502 t2tssh.bind \u2502 AllOf    \u2502 @t2tssh       \u2502 @JAMES-CL-NY   \u2502                     \u2502\n\u2502 5eSuYfv381U3qNs3vYbqpU \u2502 t2tssh.dial \u2502 AllOf    \u2502 @t2tssh       \u2502 @JAMES-CL-SF   \u2502                     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,r.kt)("p",null,"You should also make sure the policy advisor display correctly:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge policy-advisor services |grep t2tssh\nOKAY : JAMES-CL-NY (2) -> t2tssh (2) Common Routers: (2/2) Dial: N Bind: Y\nOKAY : JAMES-CL-SF (2) -> t2tssh (2) Common Routers: (2/2) Dial: Y Bind: N\n")),(0,r.kt)("p",null,'Make sure there is a "Dial" line and a "Bind" line. They are both "OKAY" and has at least 1 Common Routers.'),(0,r.kt)("h3",{id:"346-verify-the-connection"},"3.4.6 Verify the connection"),(0,r.kt)("p",null,"Login to the intercept side tunneler (",(0,r.kt)("strong",{parentName:"p"},"JAMES-CL-SF"),") node, you should be able to ssh to the server (",(0,r.kt)("strong",{parentName:"p"},"JAMES-CL-NY"),') by using dns name "t2tssh.ziti"'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"root@JAMES-CL-SF:~# ssh t2tssh.ziti\nWelcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-67-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Wed Apr  5 22:35:36 UTC 2023\n\n  System load:  0.009765625       Users logged in:       1\n  Usage of /:   3.4% of 48.27GB   IPv4 address for eth0: 104.248.116.185\n  Memory usage: 11%               IPv4 address for eth0: 10.10.0.6\n  Swap usage:   0%                IPv4 address for eth1: 10.136.219.136\n  Processes:    94                IPv4 address for tun0: 100.64.0.1\n\n * Introducing Expanded Security Maintenance for Applications.\n   Receive updates to over 25,000 software packages with your\n   Ubuntu Pro subscription. Free for personal use.\n\n     https://ubuntu.com/pro\n\nExpanded Security Maintenance for Applications is not enabled.\n\n28 updates can be applied immediately.\n21 of these updates are standard security updates.\nTo see these additional updates run: apt list --upgradable\n\nEnable ESM Apps to receive additional future security updates.\nSee https://ubuntu.com/esm or run: sudo pro status\n\n\nLast login: Wed Apr  5 20:45:18 2023 from 45.17.199.35\nroot@JAMES-CL-NY:~# <ctrl-d>\nlogout\nConnection to t2tssh.ziti closed.\nroot@JAMES-CL-SF:~#\n")),(0,r.kt)("h2",{id:"35-setup-tunnel-to-ert-http-connection"},"3.5 Setup Tunnel to ERT http connection"),(0,r.kt)("p",null,"Edge Router Tunnel (ERT) has combine router and tunneler function. In this section, we will demonstrate a connection between a Ziti-Edge-Tunnel (JAMES-CL-NY) to a ERT (JAMES-ER-SF)"),(0,r.kt)("p",null,"The procedure is similar to tunnel to tunnel service, so please refer to that section for detail explanation of each step."),(0,r.kt)("h3",{id:"351-create-a-hostv1-config"},"3.5.1 Create a host.v1 config"),(0,r.kt)("h4",{id:"3511-zac"},"3.5.1.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(63739).Z,width:"677",height:"1158"})),(0,r.kt)("h4",{id:"3512-cli"},"3.5.1.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create config t2ehostconf host.v1 \'{"protocol":"tcp", "address":"127.0.0.1", "port":8080}\'\n')),(0,r.kt)("h3",{id:"352-create-an-interceptv1-config"},"3.5.2 Create an intercept.v1 config"),(0,r.kt)("p",null,"Use destination local ip (10.124.0.2) as intercept address"),(0,r.kt)("h4",{id:"3521-zac"},"3.5.2.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(77491).Z,width:"664",height:"976"})),(0,r.kt)("p",null,"And you should have two configs:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(24688).Z,width:"1367",height:"311"})),(0,r.kt)("h4",{id:"3522-cli"},"3.5.2.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create config t2eintconf intercept.v1 \'{"protocols": ["tcp"], "addresses": ["10.124.0.2"], "portRanges": [{"low": 80, "high": 80}]}\'\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list configs |grep t2e\n\u2502 IlgnlM2srnU7s8C3hiLJA  \u2502 t2eintconf  \u2502 intercept.v1 \u2502\n\u2502 uJUtyXI5XH1wSsSCiCARp  \u2502 t2ehostconf \u2502 host.v1      \u2502\n")),(0,r.kt)("h3",{id:"353-create-service"},"3.5.3 Create Service"),(0,r.kt)("p",null,'Now we need to put these two configs into a service. We going to name the service "t2ehttp":'),(0,r.kt)("h4",{id:"3531-zac"},"3.5.3.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(45842).Z,width:"1034",height:"766"})),(0,r.kt)("h4",{id:"3532-cli"},"3.5.3.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ziti edge create service t2ehttp -c t2eintconf,t2ehostconf\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check Service")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list services |grep t2e\n\u2502 5FI8Aw0IQ7xaUMgH2rKvps \u2502 t2ehttp \u2502 true       \u2502 smartrouting        \u2502            \u2502\n")),(0,r.kt)("h3",{id:"354-create-bind-service-policy"},"3.5.4 Create Bind Service policy"),(0,r.kt)("h4",{id:"3541-zac"},"3.5.4.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(37377).Z,width:"612",height:"830"})),(0,r.kt)("h4",{id:"3542-cli"},"3.5.4.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy t2ehttp.bind Bind --service-roles '@t2ehttp' --identity-roles \"@JAMES-ER-SF\"\n")),(0,r.kt)("h3",{id:"355-create-dial-service-policy"},"3.5.5 Create Dial Service policy"),(0,r.kt)("p",null,"Now we need to specify the intercept side tunneler (",(0,r.kt)("strong",{parentName:"p"},"JAMES-CL-NY"),") for the service by setting up a dial service policy"),(0,r.kt)("h4",{id:"3551-zac"},"3.5.5.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(77421).Z,width:"632",height:"833"})),(0,r.kt)("p",null,"Check two service polices:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(23435).Z,width:"1363",height:"313"})),(0,r.kt)("h4",{id:"3552-cli"},"3.5.5.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy t2ehttp.dial Dial --service-roles '@t2ehttp' --identity-roles \"@JAMES-CL-NY\"\n")),(0,r.kt)("p",null,"Make sure both policies are setup correctly\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list service-policies |grep t2e\n\u2502 1UFHo2XRniIuORXKJaXDIZ \u2502 t2ehttp.bind \u2502 AllOf    \u2502 @t2ehttp      \u2502 @JAMES-ER-SF   \u2502                     \u2502\n\u2502 3jgxqoRp9g4axj6MM986Dt \u2502 t2ehttp.dial \u2502 AllOf    \u2502 @t2ehttp      \u2502 @JAMES-CL-NY   \u2502                     \u2502\n")),(0,r.kt)("p",null,"You should also make sure the policy advisor display correctly:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge policy-advisor services |grep t2ehttp\nOKAY : JAMES-CL-NY (2) -> t2ehttp (2) Common Routers: (2/2) Dial: Y Bind: N\nOKAY : JAMES-ER-SF (2) -> t2ehttp (2) Common Routers: (2/2) Dial: N Bind: Y\n")),(0,r.kt)("p",null,'Make sure there is a "Dial" line and a "Bind" line. They are both "OKAY" and has at least 1 Common Routers.'),(0,r.kt)("h3",{id:"356-verify-the-connection"},"3.5.6 Verify the connection"),(0,r.kt)("p",null,"Login to the router (",(0,r.kt)("strong",{parentName:"p"},"JAMES-ER-SF"),"), setup a file to send via http."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"root@JAMES-ER-SF:~# cat >hello.txt\nThis is file from Edge Router in San Francisco.\n<ctrl-d>\nroot@JAMES-ER-SF:~# python3 -m http.server 8080\nServing HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...\n")),(0,r.kt)("p",null,"Login to the intercept side tunneler (",(0,r.kt)("strong",{parentName:"p"},"JAMES-CL-NY"),") node."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"root@JAMES-CL-NY:~# curl http://10.124.0.2/hello.txt\nThis is file from Edge Router in San Francisco.\nroot@JAMES-CL-NY:~#\n")),(0,r.kt)("h3",{id:"357-conclusion"},"3.5.7 Conclusion"),(0,r.kt)("p",null,"In section, we demonstrated intercepting http (port 80) request to an IP address and forward the request to a remote http server listening to port 8080 via ziti network."),(0,r.kt)("h2",{id:"36-setup-connection-from-a-non-openziti-client"},"3.6 Setup Connection from a non-OpenZiti client"),(0,r.kt)("h3",{id:"361-introduction"},"3.6.1 Introduction"),(0,r.kt)("p",null,"In this section, we will demonstrate how to setup non-OpenZiti client to use the ziti service. The following conditions need to be met in order for this connection to work correctly:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The non-OpenZiti client has to be in the same data center as the edge router. "),(0,r.kt)("li",{parentName:"ul"},"The edge router is created with tunneler enabled.")),(0,r.kt)("p",null,"We are also need to do the following to successfully demonstrate the connection:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create host and intercept config"),(0,r.kt)("li",{parentName:"ul"},"Create service"),(0,r.kt)("li",{parentName:"ul"},"Create dial and bind policy"),(0,r.kt)("li",{parentName:"ul"},"Setup route on the non-OpenZiti client")),(0,r.kt)("p",null,'We will create an intercept at 11.11.11.11:80, and drop off at local IP (10.10.0.6) **JAMES-CL-NY" port (80).\n',(0,r.kt)("img",{alt:"Diagram",src:n(31638).Z,width:"689",height:"235"})),(0,r.kt)("h3",{id:"362-create-a-hostv1-config"},"3.6.2 Create a host.v1 config"),(0,r.kt)("p",null,"Used address ",(0,r.kt)("strong",{parentName:"p"},"10.10.0.6")," as host side destination, and port ",(0,r.kt)("strong",{parentName:"p"},"80")," as destination port."),(0,r.kt)("h4",{id:"3621-zac"},"3.6.2.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(1450).Z,width:"693",height:"1173"})),(0,r.kt)("h4",{id:"3622-cli"},"3.6.2.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create config e2thostconf host.v1 \'{"protocol":"tcp", "address":"10.10.0.6", "port":80}\'\n')),(0,r.kt)("h3",{id:"363-create-an-interceptv1-config"},"3.6.3 Create an intercept.v1 config"),(0,r.kt)("p",null,"Use a pseudo ip (11.11.11.11) as intercept address"),(0,r.kt)("h4",{id:"3631-zac"},"3.6.3.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(35631).Z,width:"653",height:"991"})),(0,r.kt)("p",null,"And you should have two configs:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(32123).Z,width:"1377",height:"300"})),(0,r.kt)("h4",{id:"3632-cli"},"3.6.3.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'ziti edge create config e2tintconf intercept.v1 \'{"protocols": ["tcp"], "addresses": ["11.11.11.11"], "portRanges": [{"low": 80, "high": 80}]}\'\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list configs\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME        \u2502 CONFIG TYPE  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 2XPvCjPhQHSXi5xWXgprFy \u2502 e2thostconf \u2502 host.v1      \u2502\n\u2502 4GxliAfD7Ww1uEpyJeb9eF \u2502 e2tintconf  \u2502 intercept.v1 \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,r.kt)("h3",{id:"364-create-service"},"3.6.4 Create Service"),(0,r.kt)("p",null,'Now we need to put these two configs into a service. We going to name the service "t2ehttp":'),(0,r.kt)("h4",{id:"3641-zac"},"3.6.4.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(10909).Z,width:"1028",height:"736"})),(0,r.kt)("h4",{id:"3642-cli"},"3.6.4.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ziti edge create service e2thttp -c e2thostconf,e2tintconf\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check Service")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list services\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME    \u2502 ENCRYPTION \u2502 TERMINATOR STRATEGY \u2502 ATTRIBUTES \u2502\n\u2502                        \u2502         \u2502  REQUIRED  \u2502                     \u2502            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 22Rxkf75JPYYgC2TYv6IHB \u2502 e2thttp \u2502 true       \u2502 smartrouting        \u2502            \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-1 of 1\n")),(0,r.kt)("h3",{id:"365-create-bind-service-policy"},"3.6.5 Create Bind Service policy"),(0,r.kt)("h4",{id:"3651-zac"},"3.6.5.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(36663).Z,width:"624",height:"831"})),(0,r.kt)("h4",{id:"3652-cli"},"3.6.5.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy e2thttp.bind Bind --service-roles '@e2thttp' --identity-roles \"@JAMES-CL-NY\"\n")),(0,r.kt)("h3",{id:"366-create-dial-service-policy"},"3.6.6 Create Dial Service policy"),(0,r.kt)("p",null,"Now we need to specify the intercept side tunneler (",(0,r.kt)("strong",{parentName:"p"},"JAMES-ER-SF"),") for the service by setting up a dial service policy"),(0,r.kt)("h4",{id:"3661-zac"},"3.6.6.1 ZAC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(15107).Z,width:"620",height:"844"})),(0,r.kt)("p",null,"Check two service polices:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Diagram",src:n(39023).Z,width:"1358",height:"300"})),(0,r.kt)("h4",{id:"3662-cli"},"3.6.6.2 CLI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create service-policy t2ehttp.dial Dial --service-roles '@e2thttp' --identity-roles \"@JAMES-ER-SF\"\n")),(0,r.kt)("p",null,"Make sure both policies are setup correctly\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge list service-policies\n\u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ID                     \u2502 NAME         \u2502 SEMANTIC \u2502 SERVICE ROLES \u2502 IDENTITY ROLES \u2502 POSTURE CHECK ROLES \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 3amYaaKuaRjbhYVnyp3E0U \u2502 t2ehttp.dial \u2502 AllOf    \u2502 @e2thttp      \u2502 @JAMES-ER-SF   \u2502                     \u2502\n\u2502 AAsWJvHALaz7hxeAHWBIX  \u2502 e2thttp.bind \u2502 AllOf    \u2502 @e2thttp      \u2502 @JAMES-CL-NY   \u2502                     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\nresults: 1-2 of 2\n")),(0,r.kt)("p",null,"You should also make sure the policy advisor display correctly:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ziti edge policy-advisor services |grep e2thttp\nOKAY : JAMES-CL-NY (2) -> e2thttp (2) Common Routers: (2/2) Dial: N Bind: Y\nOKAY : JAMES-ER-SF (2) -> e2thttp (2) Common Routers: (2/2) Dial: Y Bind: N\n")),(0,r.kt)("p",null,'Make sure there is a "Dial" line and a "Bind" line. They are both "OKAY" and has at least 1 Common Routers.'),(0,r.kt)("h3",{id:"367-verify-the-connection"},"3.6.7 Verify the connection"),(0,r.kt)("p",null,"Login to the Client (",(0,r.kt)("strong",{parentName:"p"},"JAMES-CL-NY"),"), setup a file to send via http."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"root@JAMES-CL-NY:~# cat >hello.txt\nThis is file from Open-Ziti Client in Big Apple.\n<ctrl-d>\nroot@JAMES-ER-SF:~# python3 -m http.server 80\nServing HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...\n")),(0,r.kt)("p",null,"Login to the non-OpenZiti client machine (",(0,r.kt)("strong",{parentName:"p"},"JAMES-Non-Ziti-SF"),")."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"setup the route first"),". The route is via our ER in the same DC (10.124.0.2)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"root@JAMES-Non-Ziti-SF:~# ip route add 11.11.11.11/32 via 10.124.0.2\n")),(0,r.kt)("p",null,"Now test the connection"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"root@JAMES-Non-Ziti-SF:~# curl http://11.11.11.11/hello.txt\nThis is file from Open-Ziti Client in Big Apple.\nroot@JAMES-Non-Ziti-SF:~#\n")))}d.isMDXComponent=!0},72322:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services02-router-75b8104f6b6f924e95da19cbde4b1dcc.png"},14345:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services03-router-78ec27de221bff588023d3ee7b02c6e9.png"},14977:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services04-CreateService-55878e810547d68569bfc7c3825be029.png"},87084:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services05-CreateService-7e98d38f24652c5f14222c45c2b15888.png"},70114:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services06-router-policy-727eafc8d1cad347cecd3d77b7bf7a6c.png"},28506:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services07-router-update-668c5c24c3c66a9b078917b42650090e.png"},94306:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services08-router-update-c7420ae7beab5982994348db9a0f19db.png"},35799:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services1-17ff111d2a74a1a24ab9194d72f0465a.jpg"},12173:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services10-655bc71be07a63761fc0696f4bf26f01.png"},54782:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services11-362ff69194eb84b5d7874525425d22dd.png"},50159:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services12-a4ab3663ce31dbffd8294dbbfc0d3755.png"},79723:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services13-ea447061d73ef380988bac6bf5a508cd.png"},83429:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services14-ee071b242b26121d254321885fffa7f2.png"},73005:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services15-1556684199482f89a0f0a31a402317c1.png"},41838:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services16-44fc4082e49fb8830114a34ebc61738e.png"},63739:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services20-4dbd9e18442fcfb6852aba33653602cf.png"},77491:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services21-eb83684b9ed2767713217e2e0299544f.png"},24688:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services22-61684fc739691d1ae4a0e39a71f09718.png"},45842:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services23-7283400f2e927e467cdf18a6c05e90d2.png"},37377:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services24-d2ebf76a7153a0b1121bec122ebd89b3.png"},77421:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services25-16725c772a0df51019faefaef5398e96.png"},23435:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services26-5a2f698799fe3937fe02af0306d5ea7e.png"},1450:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services30-fe87fa960eaaaeb66209a9b181874274.png"},35631:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services31-43a0b54d72dad7e556a52bc443b6eed2.png"},32123:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services32-f18cb5a4deafa876f966cc53d1eb4c26.png"},10909:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services33-9ab434f7bca42feb49c5bfa022229979.png"},36663:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services34-b655cf6bfb8b4b47651f3ecd3987740e.png"},15107:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services35-4ec1ac75d3df6b975226c88d6c9f9d2a.png"},39023:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services36-064ab049933323ecf932ee99970358a4.png"},31638:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/Services37-bea3e85d8120ec419c56ae8bbb5e45e0.png"},17228:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/ZAC4-cd71daa7e31004fd6ed6a305681675c1.jpg"}}]);
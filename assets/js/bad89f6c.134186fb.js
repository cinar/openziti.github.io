"use strict";(self.webpackChunkopen_ziti=self.webpackChunkopen_ziti||[]).push([[3534],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},k=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),k=r,h=p["".concat(s,".").concat(k)]||p[k]||d[k]||i;return n?o.createElement(h,a(a({ref:t},u),{},{components:n})):o.createElement(h,a({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=k;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:r,a[1]=l;for(var c=2;c<i;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}k.displayName="MDXCreateElement"},346:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var o=n(87462),r=(n(67294),n(3905));const i={sidebar_position:40},a="Local - With Docker",l={unversionedId:"quickstarts/network/local-with-docker",id:"quickstarts/network/local-with-docker",title:"Local - With Docker",description:"Docker is a popular container engine, and many developers enjoy using solutions delivered via",source:"@site/docs/quickstarts/network/local-with-docker.md",sourceDirName:"quickstarts/network",slug:"/quickstarts/network/local-with-docker",permalink:"/docs/quickstarts/network/local-with-docker",draft:!1,editUrl:"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/quickstarts/network/local-with-docker.md",tags:[],version:"current",sidebarPosition:40,frontMatter:{sidebar_position:40},sidebar:"rootSidebar",previous:{title:"Local - No Docker",permalink:"/docs/quickstarts/network/local-no-docker"},next:{title:"Local - Docker Compose",permalink:"/docs/quickstarts/network/local-docker-compose"}},s={},c=[{value:"Starting the Controller",id:"starting-the-controller",level:2},{value:"Required - Volume Mount",id:"required---volume-mount",level:3},{value:"Required - Known Name",id:"required---known-name",level:3},{value:"Optional - Expose Controller Port",id:"optional---expose-controller-port",level:3},{value:"Running the Controller",id:"running-the-controller",level:3},{value:"Edge Router",id:"edge-router",level:2},{value:"Testing the Network",id:"testing-the-network",level:2},{value:"Using Docker Locally",id:"using-docker-locally",level:3},{value:"Testing",id:"testing",level:3},{value:"Next Steps",id:"next-steps",level:2}],u={toc:c};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"local---with-docker"},"Local - With Docker"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.docker.com"},"Docker")," is a popular container engine, and many developers enjoy using solutions delivered via\nDocker. Ziti provides a single Docker container which contains the entire stack of Ziti components. This is not the most\ncommon mechanism for deploying containers, we recognize that. However, we think that this makes it a bit easier for\npeople to get started with deploying Ziti components using Docker. We will certainly look to create individual\ncontainers for each component in the future but for now it's a single container. You can get this container by issuing\n",(0,r.kt)("inlineCode",{parentName:"p"},"docker pull openziti/quickstart:latest"),"."),(0,r.kt)("h2",{id:"starting-the-controller"},"Starting the Controller"),(0,r.kt)("p",null,"All ",(0,r.kt)("a",{parentName:"p",href:"/docs/introduction/"},"Ziti Networks")," require\na ",(0,r.kt)("a",{parentName:"p",href:"/operations/controller"},"Ziti Controller"),". Without a controller, edge routers won't be able to authorize new\nconnections rendering a new network useless. You must have a controller running."),(0,r.kt)("h3",{id:"required---volume-mount"},"Required - Volume Mount"),(0,r.kt)("p",null,"Running Ziti locally via Docker will require you to mount a common folder which will be used to store the PKI of your\nnetwork. Without a volume mount, you'll be forced to figure out how to get the PKI in place correctly. While this is a\nstraightforward process once you know how to do it, when you're getting started this is undoubtedly complicated. We\nrecommend that if you're starting out (or if you just don't want to be bothered with these details) you should just\ncreate a folder and volume mount that folder. It's expected that this volume is mounted on ",(0,r.kt)("inlineCode",{parentName:"p"},"/persistent/pki")," inside the\ncontainer."),(0,r.kt)("h3",{id:"required---known-name"},"Required - Known Name"),(0,r.kt)("p",null,"Other containers on the Docker network will ",(0,r.kt)("strong",{parentName:"p"},"need")," to address the controller. To do this, we will give this container\na network alias. At this time it would appear that this also forces you to add the container to a network which is not\nthe default network. This is a very useful feature which allows your containers to be isolated from one another and also\nwill allow you to have multiple networks running locally if you desire. To create a Docker network issue:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker network create myFirstZitiNetwork\n")),(0,r.kt)("p",null,"Next - we need to make a folder to share our PKI as well as our environment file the controller emits. We'll just\nput it into your home directory. Move it wherever you like. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir -p ~/docker-volume/myFirstZitiNetwork\n")),(0,r.kt)("p",null,"Finally, we need to make an empty file where we expect the controller to put the env file. Let's do that now too."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'echo "#ziti.env file" > ~/docker-volume/myFirstZitiNetwork/ziti.env\n')),(0,r.kt)("p",null,"Later, when starting the controller, we'll supply this network as a parameter to the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker")," command as well as name the\nnetwork. That's done with these two options: ",(0,r.kt)("inlineCode",{parentName:"p"},"--network myFirstZitiNetwork --network-alias ziti-controller")," and\nwe'll also supply the env file as the location for the controller to use to write into."),(0,r.kt)("h3",{id:"optional---expose-controller-port"},"Optional - Expose Controller Port"),(0,r.kt)("p",null,"Docker containers by default won't expose any ports that you could use from your local machine. If you want to be able\nto use this controller from outside of Docker, you'll need to export the controller's API port. That's easy to do,\nsimply pass one more parameter to the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker")," command: ",(0,r.kt)("inlineCode",{parentName:"p"},"-p ${externalPort}:${internalPort}")),(0,r.kt)("h3",{id:"running-the-controller"},"Running the Controller"),(0,r.kt)("p",null,"Here's an example of how to launch a controller using the folder created in the steps above. Also, notice this command\npasses a couple extra flags you'll see used on this page. Notably\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"--rm")," flag and the ",(0,r.kt)("inlineCode",{parentName:"p"},"-it")," flag. The ",(0,r.kt)("inlineCode",{parentName:"p"},"--rm")," flag instructs Docker to delete the container when the container exits.\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},"-it")," flag will run the container interactively. Running interactively like this makes it easier to see the logs\nproduced, but you will need a terminal for each process you want to run. The choice is yours, but in these examples\nwe'll use ",(0,r.kt)("inlineCode",{parentName:"p"},"-it")," to make seeing the output from the logs easier."),(0,r.kt)("p",null,'Here\'s an example which will use the Docker network named "myFirstZitiNetwork" and expose the controller to your local\ncomputer on port 1280 (the default port).'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run \\\n  --network myFirstZitiNetwork \\\n  --network-alias ziti-controller \\\n  --network-alias ziti-edge-controller \\\n  -p 1280:1280 \\\n  -it \\\n  --rm \\\n  -v ~/docker-volume/myFirstZitiNetwork:/persistent/pki \\\n  -v ~/docker-volume/myFirstZitiNetwork/ziti.env:/persistent/ziti.env \\\n  openziti/quickstart \\\n  /var/openziti/scripts/run-controller.sh\n")),(0,r.kt)("h2",{id:"edge-router"},"Edge Router"),(0,r.kt)("p",null,"At this point you should have a ",(0,r.kt)("a",{parentName:"p",href:"/operations/controller"},"Ziti Controller")," running. You should have created your\nDocker network as well as creating the volume mount. Now it's time to connect your first edge router. The same Docker\nimage that runs the controller can run an edge router. To start an edge router, you will run a very similar command as\nthe one to start the controller with a couple of key differences."),(0,r.kt)("p",null,"The first noticable difference is that we need to pass in the name of the edge router we want it to be. To use this\nnetwork, the name supplied needs tobe addressable by clients.  Also notice the port exported is port 3022. This is the\ndefault port used by edge routers. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run \\\n  -e ZITI_EDGE_ROUTER_RAWNAME=ziti-edge-router-1 \\\n  --network myFirstZitiNetwork \\\n  --network-alias ziti-edge-router-1 \\\n  -p 3022:3022 \\\n  -it \\\n  --rm \\\n  -v ~/docker-volume/myFirstZitiNetwork:/persistent/pki \\\n  -v ~/docker-volume/myFirstZitiNetwork/ziti.env:/persistent/ziti.env \\\n  openziti/quickstart \\\n  /var/openziti/scripts/run-router.sh edge\n")),(0,r.kt)("p",null,"If you want to create a second edge router, you'll need to override the router port, don't forget to export that port too"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run \\\n  -e ZITI_EDGE_ROUTER_RAWNAME=ziti-edge-router-2 \\\n  -e ZITI_EDGE_ROUTER_PORT=4022 \\\n  --network myFirstZitiNetwork \\\n  --network-alias ziti-edge-router-2 \\\n  -p 4022:4022 \\\n  -it \\\n  --rm \\\n  -v ~/docker-volume/myFirstZitiNetwork:/persistent/pki \\\n  -v ~/docker-volume/myFirstZitiNetwork/ziti.env:/persistent/ziti.env \\\n  openziti/quickstart \\\n  /var/openziti/scripts/run-router.sh edge\n")),(0,r.kt)("h2",{id:"testing-the-network"},"Testing the Network"),(0,r.kt)("h3",{id:"using-docker-locally"},"Using Docker Locally"),(0,r.kt)("p",null,"A quick note. If you are not well-versed with Docker you might forget that exposing ports in Docker is one thing,\nbut you'll also need to have a hosts entry for the containers you want to access from outside of of the Docker\nnetwork. This quickstart will expect that you understand this and for every router you add you will want to make\nsure you add a host entry. In the examples above we are adding three entities: ",(0,r.kt)("inlineCode",{parentName:"p"},"ziti-edge-controller"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"ziti-edge-router-1")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ziti-edge-router-2"),"."),(0,r.kt)("h3",{id:"testing"},"Testing"),(0,r.kt)("p",null,"With the controller and router running, you can now attach to the Docker host running the Ziti controller and test that\nthe router did indeed come online and is running as you expect. To do this, we'll use another feature of the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker"),"\ncommand and ",(0,r.kt)("inlineCode",{parentName:"p"},"exec")," into the machine. First, you'll need to know your Docker container name which you can figure out by\nrunning ",(0,r.kt)("inlineCode",{parentName:"p"},"docker ps"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ docker ps\n\nCONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS          PORTS\n                   NAMES\n1b86c4b461e7   openziti/quickstart   "/var/openziti/scripts/r\u2026"   10 minutes ago   Up 10 minutes   0.0.0.0:3022->3022/tcp, :::3022->3022/tcp   musing_engelbart\na33d58248d6e   openziti/quickstart   "/var/openziti/scripts/r\u2026"   46 minutes ago   Up 46 minutes   0.0.0.0:1280->1280/tcp, :::1280->1280/tcp   xenodochial_cori\n')),(0,r.kt)("p",null,"Above, you'll see my controller is running in a container named \"xenodochial_cori\". I can tell because it's using the\ndefault port of 1280, the default port for the controller. Now I can ",(0,r.kt)("inlineCode",{parentName:"p"},"exec")," into this\ncontainer: ",(0,r.kt)("inlineCode",{parentName:"p"},"docker exec -it xenodochial_cori /bin/bash")),(0,r.kt)("p",null,"Once in the container, I can now issue ",(0,r.kt)("inlineCode",{parentName:"p"},"zitiLogin")," to authenticate the ",(0,r.kt)("inlineCode",{parentName:"p"},"ziti")," CLI."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"zitiLogin\nToken: b16f182f-88b3-4fcc-9bfc-1e32319ca486\nSaving identity 'default' to /persistent/ziti-cli.json\n")),(0,r.kt)("p",null,"And finally, once authenticated I can test to see if the edge router is online in the controller and as you'll see, the\n",(0,r.kt)("inlineCode",{parentName:"p"},"isOnline")," property is true!"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ziti@a33d58248d6e:/persistent$ ziti edge list edge-routers\nid: qNZyqZEix3    name: ziti-edge-router    isOnline: true    role attributes: {}\nresults: 1-1 of 1\n")),(0,r.kt)("h2",{id:"next-steps"},"Next Steps"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Now that you have your network in place, you probably want to try it out. Head to\n",(0,r.kt)("a",{parentName:"li",href:"/docs/quickstarts/services/"},"the services quickstart")," and start learning how to use OpenZiti."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/quickstarts/zac/installation#docker"},"Install the Ziti Console")," (web UI)"),(0,r.kt)("li",{parentName:"ul"},'Add a Second Public Router: In order for multiple routers to form transit links, they need a firewall exception to expose the "link listener" port. The default port is ',(0,r.kt)("inlineCode",{parentName:"li"},"10080/tcp"),"."),(0,r.kt)("li",{parentName:"ul"},"Help",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/quickstarts/network/help/change-admin-password"},"Change Admin Password")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/quickstarts/network/help/reset-quickstart"},"Reset the Quickstart"))))))}p.isMDXComponent=!0}}]);
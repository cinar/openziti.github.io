"use strict";(self.webpackChunkopen_ziti=self.webpackChunkopen_ziti||[]).push([[969],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>g});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=n.createContext({}),u=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),d=u(r),h=o,g=d["".concat(s,".").concat(h)]||d[h]||p[h]||l;return r?n.createElement(g,i(i({ref:t},c),{},{components:r})):n.createElement(g,i({ref:t},c))}));function g(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=r.length,i=new Array(l);i[0]=h;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a[d]="string"==typeof e?e:o,i[1]=a;for(var u=2;u<l;u++)i[u]=r[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"},20880:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>a,toc:()=>u});var n=r(87462),o=(r(67294),r(3905));const l={sidebar_position:30,sidebar_label:"Router",title:"Create new router"},i="2.0 Configure new router using open ziti",a={unversionedId:"guides/Digital_Ocean/Router",id:"guides/Digital_Ocean/Router",title:"Create new router",description:"2.1 Create a VM on Digital Ocean",source:"@site/docs/guides/Digital_Ocean/Router.md",sourceDirName:"guides/Digital_Ocean",slug:"/guides/Digital_Ocean/Router",permalink:"/docs/guides/Digital_Ocean/Router",draft:!1,editUrl:"https://github.com/openziti/ziti-doc/tree/main/docusaurus/docs/guides/Digital_Ocean/Router.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{sidebar_position:30,sidebar_label:"Router",title:"Create new router"},sidebar:"docsSidebar",previous:{title:"Controller",permalink:"/docs/guides/Digital_Ocean/Controller"},next:{title:"Services",permalink:"/docs/guides/Digital_Ocean/Services"}},s={},u=[{value:"2.1 Create a VM on Digital Ocean",id:"21-create-a-vm-on-digital-ocean",level:2},{value:"2.2 Login and Update the repo and apps on VM",id:"22-login-and-update-the-repo-and-apps-on-vm",level:2},{value:"2.2.1 apt update",id:"221-apt-update",level:3},{value:"2.2.2 Download ziti_router_auto_enroll binary",id:"222-download-ziti_router_auto_enroll-binary",level:3},{value:"2.3 Create and setup Router directly on router VM",id:"23-create-and-setup-router-directly-on-router-vm",level:2},{value:"2.3.1 Info needed for creating Router",id:"231-info-needed-for-creating-router",level:3},{value:"2.3.2 Info gathered for creating Router",id:"232-info-gathered-for-creating-router",level:3},{value:"2.3.3 Create the Router with link listener",id:"233-create-the-router-with-link-listener",level:3},{value:"2.3.4 Create the Router with link listener and tunneler",id:"234-create-the-router-with-link-listener-and-tunneler",level:3},{value:"2.3.5 Create the Router with edge listener only (no link listener)",id:"235-create-the-router-with-edge-listener-only-no-link-listener",level:3},{value:"2.3.6 Create the Router with edge listener and tunneler",id:"236-create-the-router-with-edge-listener-and-tunneler",level:3},{value:"2.4 Creating Router on Controller first",id:"24-creating-router-on-controller-first",level:2},{value:"2.4.1 Creating Router on the controller Using ZAC",id:"241-creating-router-on-the-controller-using-zac",level:3},{value:"2.4.2 Creating Router on the controller Using CLI",id:"242-creating-router-on-the-controller-using-cli",level:3},{value:"2.4.3 Register the Router with link listener",id:"243-register-the-router-with-link-listener",level:3},{value:"2.4.4 Register the Router with link listener and tunneler",id:"244-register-the-router-with-link-listener-and-tunneler",level:3},{value:"2.4.5 Register the Router with edge listener only (no link listener)",id:"245-register-the-router-with-edge-listener-only-no-link-listener",level:3},{value:"2.4.6 Register the Router with edge listener and tunneler",id:"246-register-the-router-with-edge-listener-and-tunneler",level:3},{value:"2.5 Auto start the router",id:"25-auto-start-the-router",level:2},{value:"2.6 Fix the resolver",id:"26-fix-the-resolver",level:2}],c={toc:u};function d(e){let{components:t,...l}=e;return(0,o.kt)("wrapper",(0,n.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"20-configure-new-router-using-open-ziti"},"2.0 Configure new router using open ziti"),(0,o.kt)("h2",{id:"21-create-a-vm-on-digital-ocean"},"2.1 Create a VM on Digital Ocean"),(0,o.kt)("p",null,"Please follow ",(0,o.kt)("strong",{parentName:"p"},"Section 1.1")," of the ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/Digital_Ocean/Controller/"},"Controller Guide")," to setup a VM to be used as Router. "),(0,o.kt)("h2",{id:"22-login-and-update-the-repo-and-apps-on-vm"},"2.2 Login and Update the repo and apps on VM"),(0,o.kt)("p",null,'Once the VM is created, we can get the IP address of the droplet from the Resources screen. Login to the VM by using user "root" and IP address:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"ssh root@<ip>\n")),(0,o.kt)("h3",{id:"221-apt-update"},"2.2.1 apt update"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update\nsudo apt upgrade\n")),(0,o.kt)("h3",{id:"222-download-ziti_router_auto_enroll-binary"},"2.2.2 Download ziti_router_auto_enroll binary"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"ziti_router_auto_enroll")," is an easy way to setup your router automatically."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://github.com/netfoundry/ziti_router_auto_enroll/releases/latest/download/ziti_router_auto_enroll.tar.gz\ntar xf ziti_router_auto_enroll.tar.gz\n")),(0,o.kt)("p",null,"You should have a file ",(0,o.kt)("strong",{parentName:"p"},"ziti_router_auto_enroll")," under the directory."),(0,o.kt)("p",null,"For detail info on ziti_router_auto_enroll, please checkout the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/netfoundry/ziti_router_auto_enroll"},"github page")),(0,o.kt)("h2",{id:"23-create-and-setup-router-directly-on-router-vm"},"2.3 Create and setup Router directly on router VM"),(0,o.kt)("p",null,"You can setup the router directly on the router VM with one command if you did not block your controller's edge-management port. At this time, the quickstart for setting up controller does not separate edge-management port from edge-client port, so the edge-management port has to be open. You may continue this section if you know your controller's management password, Fabric Port (default 8440) and Management Port (default 8441)."),(0,o.kt)("p",null,"You can also choose to create router on the controller and then register with the jwt file (created when creating the router) on the router. The procedure for this is detailed in ",(0,o.kt)("strong",{parentName:"p"},"section 2.4")),(0,o.kt)("h3",{id:"231-info-needed-for-creating-router"},"2.3.1 Info needed for creating Router"),(0,o.kt)("p",null,"In order to create the Router, the VM needs to contact controller. We need the following information before we can continue:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Controller IP"),(0,o.kt)("li",{parentName:"ul"},"Controller Fabric Port: On the controller, issue this command ",(0,o.kt)("strong",{parentName:"li"},"echo $ZITI_CTRL_PORT")),(0,o.kt)("li",{parentName:"ul"},"Controller Management Port: On the controller, issue this command ",(0,o.kt)("strong",{parentName:"li"},"echo $ZITI_EDGE_CONTROLLER_PORT")),(0,o.kt)("li",{parentName:"ul"},"Controller Passwd: On the controller, issue this command ",(0,o.kt)("strong",{parentName:"li"},"echo $ZITI_PWD")),(0,o.kt)("li",{parentName:"ul"},"Router Name: Name for this router")),(0,o.kt)("h3",{id:"232-info-gathered-for-creating-router"},"2.3.2 Info gathered for creating Router"),(0,o.kt)("p",null,"Here is information I gathered from previous step:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Controller IP: 161.35.108.218"),(0,o.kt)("li",{parentName:"ul"},"Controller Fabric Port: 8440 ",(0,o.kt)("strong",{parentName:"li"},"(default value if following controller setup guide)")),(0,o.kt)("li",{parentName:"ul"},"Controller Management Port: 8441 ",(0,o.kt)("strong",{parentName:"li"},"(default value if following controller setup guide)")),(0,o.kt)("li",{parentName:"ul"},"Controller Passwd: Test@123"),(0,o.kt)("li",{parentName:"ul"},"Router Name: JAMES-ER-SF")),(0,o.kt)("p",null,"We are also going to create the router without healthcheck section and metrics, so the following two options will be used to create the router:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"--disableHealthChecks"),(0,o.kt)("li",{parentName:"ul"},"--disableMetrics")),(0,o.kt)("p",null,"If you choose to explore these two functionalities, you can remove the options (from command line) when creating router."),(0,o.kt)("h3",{id:"233-create-the-router-with-link-listener"},"2.3.3 Create the Router with link listener"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./ziti_router_auto_enroll -f -n --controller 161.35.108.218 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --assumePublic --disableHealthChecks --disableMetrics --routerName JAMES-ER-SF \n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"output")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"2023-04-05-04:07:44-INFO-Writing jwt file: JAMES-ER-SF_enrollment.jwt\n2023-04-05-04:07:44-INFO-Version not specified, going to check with controller\n2023-04-05-04:07:45-INFO-Found version 0.27.7\n2023-04-05-04:07:45-INFO-Downloading file: https://github.com/openziti/ziti/releases/download/v0.27.7/ziti-linux-amd64-0.27.7.tar.gz\nDownloading: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 115M/115M [00:01<00:00, 67.3MiB/s]\n2023-04-05-04:07:47-INFO-Successfully downloaded file\n2023-04-05-04:07:47-INFO-Starting binary install\n2023-04-05-04:07:50-INFO-Installing service unit file\n2023-04-05-04:07:50-INFO-Creating config file\n2023-04-05-04:07:50-INFO-Starting Router Enrollment\n2023-04-05-04:07:54-INFO-Successfully enrolled Ziti\n2023-04-05-04:07:54-INFO-Service ziti-router.service start successful.\nCreated symlink /etc/systemd/system/multi-user.target.wants/ziti-router.service \u2192 /etc/systemd/system/ziti-router.service.\n2023-04-05-04:07:55-INFO-Service ziti-router.service enable successful.\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Alternative way of creating router")),(0,o.kt)("p",null,"Instead of passing parameters through the command line to create routers, the parameters can be specified via environmental variables. Here is example on how to accomplish that."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'export CONTROLLER="161.35.108.218"\nexport CONTROLLERFABRICPORT="8440"\nexport CONTROLLERMGMTPORT="8441"\nexport ADMINUSER="admin"\nexport ADMINPASSWORD="Test@123"\n\n./ziti_router_auto_enroll -f -n --assumePublic --disableHealthChecks --disableMetrics --routerName JAMES-ER-SF\n')),(0,o.kt)("h3",{id:"234-create-the-router-with-link-listener-and-tunneler"},"2.3.4 Create the Router with link listener and tunneler"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./ziti_router_auto_enroll -f -n --controller 161.35.108.218 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --assumePublic --disableHealthChecks --disableMetrics --autoTunnelListener --routerName JAMES-ER-SF\n")),(0,o.kt)("h3",{id:"235-create-the-router-with-edge-listener-only-no-link-listener"},"2.3.5 Create the Router with edge listener only (no link listener)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./ziti_router_auto_enroll -f -n --controller 161.35.108.218 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --disableMetrics --routerName JAMES-ER-SF \n")),(0,o.kt)("h3",{id:"236-create-the-router-with-edge-listener-and-tunneler"},"2.3.6 Create the Router with edge listener and tunneler"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./ziti_router_auto_enroll -f -n --controller 161.35.108.218 --controllerFabricPort 8440 --controllerMgmtPort 8441 --adminUser admin --adminPassword Test@123 --disableHealthChecks --disableMetrics --autoTunnelListener --routerName JAMES-ER-SF\n")),(0,o.kt)("h2",{id:"24-creating-router-on-controller-first"},"2.4 Creating Router on Controller first"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"If you already go through the procedure in section 2.3, you can skip to section 2.5")),(0,o.kt)("p",null,"You can create the router on the controller first then register the router on the router VM."),(0,o.kt)("h3",{id:"241-creating-router-on-the-controller-using-zac"},"2.4.1 Creating Router on the controller Using ZAC"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"If you prefer to create router using CLI, you can jump to next section.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"In order to complete the procedures in this section, you need to install ZAC first and have access to the controller using the ZAC. If you have trouble using ZAC, you can use the CLI procedures to create router.")),(0,o.kt)("p",null,"From the ZAC welcome screen, choose the ",(0,o.kt)("strong",{parentName:"p"},"ROUTERS")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(95815).Z,width:"323",height:"638"})),(0,o.kt)("p",null,"Click on ",(0,o.kt)("strong",{parentName:"p"},"+")," to bring up the ",(0,o.kt)("strong",{parentName:"p"},"CREATE EDGE ROUTER")," widget. The ",(0,o.kt)("strong",{parentName:"p"},"NAME")," of Router is required, and it has to be unique. Also choose whether you want the tunneler to be enable or not on the router.  Enter other optional fields and hit ",(0,o.kt)("strong",{parentName:"p"},"SAVE")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(11606).Z,width:"726",height:"807"})),(0,o.kt)("p",null,"If the router is created successfully, you will be back to the ",(0,o.kt)("strong",{parentName:"p"},"MANAGE EDGE ROUTERS")," screen.  From the list of edge routers, you will see the ",(0,o.kt)("strong",{parentName:"p"},"JWT")," icon on the newly created router. You need this JWT for the registration."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(26155).Z,width:"1294",height:"552"})),(0,o.kt)("p",null,"Click on the ",(0,o.kt)("strong",{parentName:"p"},"JWT ICON"),", the JWT will be downloaded to your machine. On Chrome browser, the downloaded file will appear on the bottom right corner of the browser like picture below."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(43004).Z,width:"306",height:"57"})),(0,o.kt)("p",null,"Open the JWT file, and copy the content.  Now you are ready for the registration."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Diagram",src:r(5959).Z,width:"1643",height:"125"})),(0,o.kt)("h3",{id:"242-creating-router-on-the-controller-using-cli"},"2.4.2 Creating Router on the controller Using CLI"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"If you already created router using ZAC, you can skip ahead to register the router.")," Otherwise, this section provides CLI commands to create routers on the controller."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"login to controller"),"\nlogin to CLI first"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"zitiLogin\n")),(0,o.kt)("p",null,"To create an edge router (no tunneler)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create edge-router JAMES-ER-SF -o JAMES-ER-SF.jwt\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"output")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"New edge router JAMES-ER-SF2 created with id: BzUtjC7E.\nEnrollment expires at 2023-04-07T03:52:03.997Z\n")),(0,o.kt)("p",null,"To create an edge router with tunneler"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"ziti edge create edge-router JAMES-ER-SF -t -o JAMES-ER-SF.jwt\n")),(0,o.kt)("p",null,"Cat out the content of the jwt file. We will need to use the jwt to register router"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# cat  JAMES-ER-SF.jwt\neyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6ImVyb3R0IiwiZXhwIjoxNjgwODM5NjA4LCJpc3MiOiJodHRwczovLzE2MS4zNS4xMDguMjE4Ojg0NDEiLCJqdGkiOiJhNDg5N2Q0ZS1lZTY4LTQ1M2UtYjY1NS03MGU0YjgyZTllNDciLCJzdWIiOiJpY2JLakM3RS5QIn0.Y6DohYyWEeJQmRMe29v4cL3Y1APCnBlrv_-S_941au2OESuQdt2CS4C4djvESYzV5vbnbgZgyU5xtNvb4lW5Uv2HP3XUGQNVsWjpwZbazNoTXg1IX6hhWb7T6u1AhS4xnJ3jpoapKsdOkUSqeQNUMSiN3aeLNcGVA_XK1-utCYjVsHDC90M1ZYZqgd8C9IKziDI10XQVlKTqosv8hoJD0OKIu7WZMslweRSMBtQUA2lZ2QSkIhFr2bvtgPll-5aBnG7eo6Ka_WtEW6EikU2fxgpNaVVBEIdZs1tkdGU6dfBDA6j5wA1TBI0FZnuKlNW24bMZCWKy2B_AMqJW1a80I0qNDx-QHEy-pt8FzZ-eqXWyfhc_nYzwT9kr6hO9VJrrD81hboCeTl8G6EXZjwCi2lPbKHROtkQu08-Ns1Kps7R3GILeNMltW9tKApP746ek4DVxm2cKqiB1Axcb0tNjDWTthjyp8m40aSiiqOPIoQbwa43JLqbHcuhZOSBLQNb_bwzkxBSf34D2w5eVETWy9VX-lgHwM-uhT5SfZIWdnWtO7-Cxn-cqgz89twtOim-yc5j0p0ieAbrOArbjKFBXiQjP8yWkorQKlj5PTSk7vyb3X4q6p--RxP2Z5F8alCPQx3XiVcohvIJnrJiEP86myNIYcKhhJ4OB4r9iOr0qTc8\n")),(0,o.kt)("p",null,"We also need the management port (default 8441) and fabric port (default 8440) of the controller to register the router"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# echo $ZITI_EDGE_CONTROLLER_PORT\n8441\n# echo $ZITI_CTRL_PORT\n8440\n")),(0,o.kt)("h3",{id:"243-register-the-router-with-link-listener"},"2.4.3 Register the Router with link listener"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Perform this on the Router VM")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"command")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --assumePublic --disableHealthChecks --disableMetrics <jwt content>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --assumePublic --disableHealthChecks --disableMetrics eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbSI6ImVyb3R0IiwiZXhwIjoxNjgwODM5NjA4LCJpc3MiOiJodHRwczovLzE2MS4zNS4xMDguMjE4Ojg0NDEiLCJqdGkiOiJhNDg5N2Q0ZS1lZTY4LTQ1M2UtYjY1NS03MGU0YjgyZTllNDciLCJzdWIiOiJpY2JLakM3RS5QIn0.Y6DohYyWEeJQmRMe29v4cL3Y1APCnBlrv_-S_941au2OESuQdt2CS4C4djvESYzV5vbnbgZgyU5xtNvb4lW5Uv2HP3XUGQNVsWjpwZbazNoTXg1IX6hhWb7T6u1AhS4xnJ3jpoapKsdOkUSqeQNUMSiN3aeLNcGVA_XK1-utCYjVsHDC90M1ZYZqgd8C9IKziDI10XQVlKTqosv8hoJD0OKIu7WZMslweRSMBtQUA2lZ2QSkIhFr2bvtgPll-5aBnG7eo6Ka_WtEW6EikU2fxgpNaVVBEIdZs1tkdGU6dfBDA6j5wA1TBI0FZnuKlNW24bMZCWKy2B_AMqJW1a80I0qNDx-QHEy-pt8FzZ-eqXWyfhc_nYzwT9kr6hO9VJrrD81hboCeTl8G6EXZjwCi2lPbKHROtkQu08-Ns1Kps7R3GILeNMltW9tKApP746ek4DVxm2cKqiB1Axcb0tNjDWTthjyp8m40aSiiqOPIoQbwa43JLqbHcuhZOSBLQNb_bwzkxBSf34D2w5eVETWy9VX-lgHwM-uhT5SfZIWdnWtO7-Cxn-cqgz89twtOim-yc5j0p0ieAbrOArbjKFBXiQjP8yWkorQKlj5PTSk7vyb3X4q6p--RxP2Z5F8alCPQx3XiVcohvIJnrJiEP86myNIYcKhhJ4OB4r9iOr0qTc8 \n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"output")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"2023-04-07-01:07:49-INFO-Version not specified, going to check with controller\n2023-04-07-01:07:49-INFO-Found version 0.27.7\n2023-04-07-01:07:49-INFO-Downloading file: https://github.com/openziti/ziti/releases/download/v0.27.7/ziti-linux-amd64-0.27.7.tar.gz\nDownloading: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 115M/115M [00:01<00:00, 68.9MiB/s]\n2023-04-07-01:07:51-INFO-Successfully downloaded file\n2023-04-07-01:07:51-INFO-Starting binary install\n2023-04-07-01:07:54-INFO-Installing service unit file\n2023-04-07-01:07:55-INFO-Service ziti-router daemon-reload successful.\n2023-04-07-01:07:55-INFO-Creating config file\n2023-04-07-01:07:55-INFO-Starting Router Enrollment\n2023-04-07-01:07:57-INFO-Successfully enrolled Ziti\n2023-04-07-01:07:57-INFO-Service ziti-router.service start successful.\n2023-04-07-01:07:57-INFO-Service ziti-router.service enable successful.\n")),(0,o.kt)("h3",{id:"244-register-the-router-with-link-listener-and-tunneler"},"2.4.4 Register the Router with link listener and tunneler"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --assumePublic --disableHealthChecks --disableMetrics --autoTunnelListener <jwt content>\n")),(0,o.kt)("h3",{id:"245-register-the-router-with-edge-listener-only-no-link-listener"},"2.4.5 Register the Router with edge listener only (no link listener)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --disableHealthChecks --disableMetrics <jwt content>\n")),(0,o.kt)("h3",{id:"246-register-the-router-with-edge-listener-and-tunneler"},"2.4.6 Register the Router with edge listener and tunneler"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./ziti_router_auto_enroll -f -n --controllerFabricPort 8440 --controllerMgmtPort 8441 --disableHealthChecks --disableMetrics --autoTunnelListener <jwt content>\n")),(0,o.kt)("h2",{id:"25-auto-start-the-router"},"2.5 Auto start the router"),(0,o.kt)("p",null,"After enroll the router, a systemd service file is automatically created and enabled. To check the status of the service file, issue the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl status ziti-router\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Output")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u25cf ziti-router.service - Ziti-Router\n     Loaded: loaded (/etc/systemd/system/ziti-router.service; enabled; vendor preset: enabled)\n     Active: active (running) since Wed 2023-04-05 14:45:59 UTC; 4s ago\n   Main PID: 18381 (ziti)\n      Tasks: 6 (limit: 2323)\n     Memory: 16.5M\n        CPU: 222ms\n     CGroup: /system.slice/ziti-router.service\n             \u2514\u250018381 /opt/ziti/ziti router run /opt/ziti/config.yaml\n")),(0,o.kt)("p",null,"If the status shows ",(0,o.kt)("strong",{parentName:"p"},"active (running)"),", then the setup finished correctly."),(0,o.kt)("p",null,"On the controller, you can check the status of the routers. Please refer to the controller guide (useful command for the Router) section for more information."),(0,o.kt)("h2",{id:"26-fix-the-resolver"},"2.6 Fix the resolver"),(0,o.kt)("p",null,"If you run router without tunneler enabled, you can skip this section."),(0,o.kt)("p",null,"We need to remove the digital ocean resolver for tunnel resolver to work correctly."),(0,o.kt)("p",null,"Check resolver before any changes:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# resolvectl\nGlobal\n         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported\n  resolv.conf mode: stub\nCurrent DNS Server: 67.207.67.2\n       DNS Servers: 67.207.67.2 67.207.67.3\n...\n...\n")),(0,o.kt)("p",null,'Under the Global DNS servers, it should say something like "67.207.67.2 67.207.67.3"'),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Now, make changes to the resolver:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd /etc/systemd/resolved.conf.d/\nrm DigitalOcean.conf\nsudo ln -s /dev/null DigitalOcean.conf\nsystemctl restart systemd-resolved.service\n")),(0,o.kt)("p",null,"Check resolver again "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# resolvectl\nGlobal\n         Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported\n  resolv.conf mode: stub\nCurrent DNS Server: 146.190.120.86\n       DNS Servers: 146.190.120.86\n...\n...       \n")),(0,o.kt)("p",null,"Now the Global DNS servers should be the IP address on your local interface."))}d.isMDXComponent=!0},95815:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/ZAC01-router-d367a52a762e51de055184325befc14f.png"},11606:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/ZAC02-router-0afcb807ad641c1ab3a20405f160c668.png"},26155:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/ZAC03-router-57fbfd25d7c9a3714119b6abc3035798.png"},43004:(e,t,r)=>{r.d(t,{Z:()=>n});const n="data:image/png;base64,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"},5959:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/ZAC05-router-025d44c743040a6435b796ba4b507853.png"}}]);
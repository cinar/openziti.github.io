<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Zitifying SSH | Ziti </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Zitifying SSH | Ziti ">
    <meta name="generator" content="docfx 2.x">
    
    <link rel="shortcut icon" href="../../../images/favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
    <!--span>this is text</span-->
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400&amp;display=swap" rel="stylesheet">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../images/ziti-logo-40.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div style="display: flex;">
                    <div class="form-group" style="valign: center;position: relative;">
                      <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                    </div>
                    <div style="position: relative">
                        &nbsp;
                    </div>
                    <div style="position: relative">
                        <a href="https://github.com/openziti">
                            <img src="../../../images/github-white.svg" alt="view us on github" title="view us on github" height="34px">
                        </a>
                    </div>
                    <div style="position: relative">
                        <a href="https://openziti.discourse.group">
                            <img src="../../../images/discourse_icon_halo.svg" alt="Start a conversation on Discourse" title="Start a conversation on Discourse" height="34px">
                        </a>
                    </div>
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="zitifying-ssh">Zitifying SSH</h1>

<p>As we learned in the <a href="../index.html">opening post</a>, &quot;zitifying&quot; an application means to embed a Ziti SDK into an
application and leverage the power of
a <a href="https://openziti.github.io/ziti/overview.html#overview-of-a-ziti-network">Ziti Network</a> to provide secure, truly
zero-trust access to your application no matter where in the world that application goes. In this post we are going to
see how we have zitified <code>ssh</code> and why. Future posts will expand on this even further by showing how NetFoundry
uses <code>zssh</code> to support our customers.</p>
<hr>

<h2 id="why-ssh">Why SSH?</h2>
<p>As I sit here typing these words, I can tell you&#39;re skeptical. I can tell you&#39;re wondering why in the world we would
even attempt to mess with <code>ssh</code> at all. After all, <code>ssh</code> has been a foundation of the administration of not only home
networks but also corporate networks and the internet itself. Surely if millions (billions?) of computers can interact
every day safely and securely using <code>ssh</code> there is &quot;no need&quot; for us to be spending time zitifying <code>ssh</code>
right? (Spoiler alert: wrong)</p>
<p>I&#39;m sure you&#39;ve guessed that this is not the case whatsoever. After all, attackers don&#39;t leave <code>ssh</code> alone just because
it&#39;s not worth it to try! Put a machine on the open internet, expose <code>ssh</code> on port 22 and watch for yourself all the
attempts to access <code>ssh</code> using known default/weak/bad passwords flood in. Attacks don&#39;t only come from the internet
either! Attacks from a single compromised machine on your network very well could behave in the same way as an outside
attacker. This is particularly true for ransomware-style attacks as the compromised machine attempts to expand/multiply.
The problems don&#39;t just stop here either. DoS attacks, other zero-day type bugs and more are all waiting for any service
sitting on the open internet.</p>
<p>A zitified <code>ssh</code> client is superior since the port used by <code>ssh</code> can be eliminated from the internet-based firewall
preventing any connections whatsoever from any network client. In this configuration the <code>ssh</code> process is effectively &quot;
dark&quot;. The only way to
<code>ssh</code> to a machine configured in this way is to have an identity authorized for
that <a href="https://openziti.github.io/ziti/overview.html#overview-of-a-ziti-network">Ziti Network</a>. Cool right? Let&#39;s see how
we did it and how you can do the same thing using
a <a href="https://openziti.github.io/ziti/overview.html#overview-of-a-ziti-network">Ziti Network</a>.</p>
<p>Overview of SSH - notice how port 22 is open to inbound connections:</p>
<p><img src="ssh-overview.svg" alt="ssh-overview.svg"></p>
<hr>

<h2 id="how-its-done">How It&#39;s Done</h2>
<p>There are a few steps necessary before being able to use <code>zssh</code>:</p>
<ul>
<li>Establish a <a href="https://github.com/openziti/ziti/blob/release-next/quickstart/aws.md">Ziti Network in AWS</a> (using AWS in
this example)</li>
<li>Create and enroll two Ziti Endpoints (one for our <code>ssh</code> server, one for the client)<ul>
<li>the <code>sshd</code> server will run <code>ziti-tunnel</code> for this demonstration. Conveniently it will run on the same machine I
used to setup the <a href="https://openziti.github.io/ziti/overview.html#overview-of-a-ziti-network">Ziti Network</a>.</li>
<li>the client in this case will run <code>zssh</code> from my local machine and I&#39;ll <code>zssh</code> to the other endpoint</li>
</ul>
</li>
<li>Create the <a href="https://openziti.github.io/ziti/services/overview.html">Ziti Service</a> we&#39;ll use and authorize the two
endpoints to use this service</li>
<li>Use the <code>zssh</code> binary from the client side and the <code>ziti-tunnel</code> binary from the serving side to connect</li>
<li>Harden <code>sshd</code> further by removing port 22 from any internet-based firewall configuration (for example, from within the
security-groups wizard in AWS) or by forcing <code>sshd</code> to only listen on <code>localhost/127.0.0.1</code></li>
</ul>
<p>Overview of ZSSH - notice port 22 is no longer open to inbound connections:</p>
<p><img src="zssh-overview.svg" alt="zssh-overview.svg"></p>
<p>After performing these steps you&#39;ll have an <code>sshd</code> server that is dark to the internet. Accessing the server via <code>ssh</code>
must now occur using the Ziti Network. Since the service is no longer accessible directly through a network, it is no
longer susceptible to the types of attacks mentioned previously!</p>
<hr>

<h2 id="zssh-in-action">Zssh in Action</h2>
<p>Once the prerequisites are satisfied, we can see <code>zssh</code> in action. Simply download the binary for your platform:</p>
<ul>
<li><a href="https://github.com/openziti-incubator/zssh/releases/download/latest-tag/zssh-linux-amd64">linux</a></li>
<li><a href="https://github.com/openziti-incubator/zssh/releases/download/latest-tag/zssh-windows-amd64.exe">windows</a></li>
<li><a href="https://github.com/openziti-incubator/zssh/releases/download/latest-tag/zssh-macos-amd64">MacOs</a></li>
</ul>
<p>Once you have the executable download, make sure it is named <code>zssh</code> and for simplicity&#39;s sake we&#39;ll assume it&#39;s on the
path. A goal for <code>zssh</code> is to make the usage of the command very similar to the usage of <code>ssh</code>. Anyone familiar
with <code>zssh</code> should be able to pick up <code>zssh</code> easily. As with most tooling executing the binary with no arguments will
display the expected usage. The general format when using <code>zssh</code> will be similar to that
of <code>ssh</code>: <code>zssh &lt;remoteUsername&gt;@&lt;targetIdentity&gt;</code></p>
<p>Below you can see me <code>zssh</code> from my local machine to the AWS machine secured by <code>ziti-tunnel</code>:</p>
<pre><code>./zssh ubuntu@ziti-tunnel-aws
INFO[0000] connection to edge router using token 95c45123-9415-49d6-930a-275ada9ae06f
connected.
ubuntu@ip-172-31-27-154:~$
</code></pre><p>It really was that simple! Now let&#39;s break down the current flags for <code>zssh</code> and exactly how this worked.</p>
<hr>

<h2 id="zssh-flags">Zssh Flags</h2>
<p>We know that <code>zssh</code> requires access to
a <a href="https://openziti.github.io/ziti/overview.html#overview-of-a-ziti-network">Ziti Network</a> but it is not clear from the
example above is where <code>zzsh</code> found the credentials required to access the network. <code>zssh</code> supports three basic flags:</p>
<pre><code>-i, --SshKeyPath string   Path to ssh key. default: $HOME/.ssh/id_rsa
-c, --ZConfig string      Path to ziti config file. default: $HOME/.ziti/zssh.json
-d, --debug               pass to enable additional debug information
</code></pre><p>What you see above is exactly the output <code>zssh</code> provides should you pass the <code>-h/--help</code> flag or execute <code>zssh</code>
without any parameters. The <code>-i/--SshKeyPath</code> flag is congruent to the <code>-i</code> flag for <code>ssh</code>. You would use it to supply
your key to the <code>ssh</code> client. Under the hood of <code>zssh</code> is a full-fledged <code>ssh</code> client that works similarly to how
<code>ssh</code> does. If your <code>~/.ssh/id_rsa</code> file is in the <code>authorized_keys</code> of the remote machine, then you won&#39;t need to
specify the <code>-i/</code> flag (as I didn&#39;t in my example). Using <code>zssh</code> requires the use of a public/private key in order for
the <code>zssh</code> client to connect to the remote machine. At this</p>
<p>The <code>-c/--ZConfig</code> flag controls access to the network. A configuration file must be supplied to use
<code>zssh</code> but does not need to be supplied as part of the command. By default, <code>zssh</code> will look at your home directory in a
folder named <code>.ziti</code> for a file named <code>zssh.json</code>. In bash this is would be the equivalent of <code>$HOME</code>. In Windows this
is the equivalent the environment variable named <code>USERPROFILE</code>. You do not need to supply this flag if a file exists at
the default location. You can specify this flag to use <code>zssh</code> with other networks.</p>
<p>The <code>-d/--debug</code> flag outputs additional information to assist you with debugging. For example:</p>
<pre><code>$ ./zssh ubuntu@ziti-tunnel-aws -d
INFO[0000]     sshKeyPath set to: /home/myUser/.ssh/id_rsa
INFO[0000]        ZConfig set to: /home/myUser/.ziti/zssh.json
INFO[0000]       username set to: ubuntu
INFO[0000] targetIdentity set to: ziti-tunnel-aws
INFO[0000] connection to edge router using token 95c45123-a234-412e-8997-96139fbd1938
connected.
ubuntu@ip-172-31-27-154:~$
</code></pre><p>Shown above is also one additional piece of information, the remote username. Shown in the example above I have
<code>zssh</code>ed to an ubuntu image in AWS. When it was provisioned AWS used the username <code>ubuntu</code>. In order to
<code>zssh</code> to this machine I need to tell the remote <code>sshd</code> server that I wish to attach as the <code>ubuntu</code> user. If your
username is the same for your local environment as the remote machine you do not need to specify the username. For
example, my local username is <code>cd</code>
(my initials). When I <code>zssh</code> to my dev machine I can simply use <code>zssh ClintLinux</code>:</p>
<pre><code>$ ./zssh ClintLinux
INFO[0000] connection to edge router using token 909dfb4f-fa83-4f73-af8e-ed251bcd30be
connected.
cd@clint-linux-vm ~
</code></pre><p>Hopefully this post has been helpful and insightful. Zitifying an application is <em>POWERFUL</em>!!!!</p>
<p>(keeping the focus to start on client-side compromise - maybe a PS at the end that says “btw, we can do the same for
sshd - ziti don’t care if client or server - just a big ole friendly mesh of secure goodness”</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/openziti/ziti-doc/blob/master/docfx_project/articles/zitification/ssh/zitifying-ssh.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span class='pull-left'><span><a href='https://netfoundry.io'>©2020 NetFoundry,Inc.</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/privacy-policy'>Privacy Policy</a></span>&nbsp;&nbsp;<span><a href='https://www.netfoundry.io/legal-items'>Legal</a></span>&nbsp;&nbsp;<span><a href='https://netfoundry.zendesk.com/hc/en-us'>Support</a></span>&nbsp;&nbsp;</span><span class='pull-right'><span><a href='https://www.facebook.com/NetFoundry/' target='_blank'><img height='25' src='https://image.flaticon.com/icons/svg/145/145802.svg'></a></span>&nbsp;<span><a href='https://twitter.com/netfoundry' target='_blank'><img height='25' src='https://image.flaticon.com/icons/svg/145/145812.svg'></a></span>&nbsp;<span><a href='https://www.linkedin.com/company/netfoundry/' target='_blank'><img height='25' src='https://image.flaticon.com/icons/svg/145/145807.svg'></a></span>&nbsp;<span><a href='https://www.youtube.com/channel/UCGN6PFj1rZu50yme9YsICmg' target='_blank'><img height='25' src='https://image.flaticon.com/icons/svg/174/174883.svg'></a></span>&nbsp;&nbsp;&nbsp;</span><br>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
